<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "6e562d7e5a77c8982da4aa8f762ad1d8",
  "translation_date": "2025-07-14T02:55:43+00:00",
  "source_file": "05-AdvancedTopics/mcp-security-entra/README.md",
  "language_code": "bn"
}
-->
# AI ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ рж╕рзБрж░ржХрзНрж╖рж╛: Model Context Protocol рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп Entra ID ржкрзНрж░ржорж╛ржгрзАржХрж░ржг

## ржкрж░рж┐ржЪрж┐рждрж┐
ржЖржкржирж╛рж░ Model Context Protocol (MCP) рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЦрж╛ ржарж┐ржХ рждрзЗржоржирж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржпрзЗржоржи ржЖржкржирж╛рж░ ржмрж╛ржбрж╝рж┐рж░ рж╕рж╛ржоржирзЗрж░ ржжрж░ржЬрж╛ рж▓ржХ ржХрж░рж╛ред MCP рж╕рж╛рж░рзНржнрж╛рж░ ржЦрзЛрж▓рж╛ рж░рзЗржЦрзЗ ржжрж┐рж▓рзЗ ржЖржкржирж╛рж░ ржЯрзБрж▓ ржПржмржВ ржбрзЗржЯрж╛ ржЕржиржирзБржорзЛржжрж┐ржд ржкрзНрж░ржмрзЗрж╢рзЗрж░ ржЭрзБржБржХрж┐рждрзЗ ржкржбрж╝рзЗ, ржпрж╛ ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж▓ржЩрзНржШржирзЗрж░ ржХрж╛рж░ржг рж╣рждрзЗ ржкрж╛рж░рзЗред Microsoft Entra ID ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржХрзНрж▓рж╛ржЙржб-ржнрж┐рждрзНрждрж┐ржХ ржкрж░рж┐ржЪржпрж╝ ржУ ржкрзНрж░ржмрзЗрж╢рж╛ржзрж┐ржХрж╛рж░ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛ рж╕ржорж╛ржзрж╛ржи ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ, ржпрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕржирзБржорзЛржжрж┐ржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржмржВ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЗ ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржПржЗ ржЕржВрж╢рзЗ, ржЖржкржирж┐ рж╢рж┐ржЦржмрзЗржи ржХрж┐ржнрж╛ржмрзЗ Entra ID ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж╛рж░ AI ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░ржмрзЗржиред

## рж╢рзЗржЦрж╛рж░ ржЙржжрзНржжрзЗрж╢рзНржп
ржПржЗ ржЕржВрж╢ рж╢рзЗрж╖ ржХрж░рж╛рж░ ржкрж░, ржЖржкржирж┐ рж╕ржХрзНрж╖ржо рж╣ржмрзЗржи:

- MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж╛рж░ ржЧрзБрж░рзБрждрзНржм ржмрзБржЭрждрзЗред
- Microsoft Entra ID ржПржмржВ OAuth 2.0 ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржорзМрж▓рж┐ржХ ржзрж╛рж░ржгрж╛ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░рждрзЗред
- ржкрж╛ржмрж▓рж┐ржХ ржПржмржВ ржХржиржлрж┐ржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯрзЗрж░ ржоржзрзНржпрзЗ ржкрж╛рж░рзНржержХрзНржп ржЪрж┐ржирждрзЗред
- рж╕рзНржерж╛ржирзАржпрж╝ (ржкрж╛ржмрж▓рж┐ржХ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ) ржПржмржВ рж░рж┐ржорзЛржЯ (ржХржиржлрж┐ржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ) MCP рж╕рж╛рж░рзНржнрж╛рж░ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рждрзЗ Entra ID ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рждрзЗред
- AI ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ ржЙржирзНржиржпрж╝ржирзЗрж░ рж╕ржоржпрж╝ рж╕рзБрж░ржХрзНрж╖рж╛рж░ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржиржЧрзБрж▓рзЛ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рждрзЗред

## ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржПржмржВ MCP

ржпрзЗржоржи ржЖржкржирж┐ ржЖржкржирж╛рж░ ржмрж╛ржбрж╝рж┐рж░ рж╕рж╛ржоржирзЗрж░ ржжрж░ржЬрж╛ ржЦрзЛрж▓рж╛ рж░рж╛ржЦржмрзЗржи ржирж╛, рждрзЗржоржирж┐ MCP рж╕рж╛рж░рзНржнрж╛рж░ржУ рж╕ржмрж╛рж░ ржЬржирзНржп ржЙржирзНржорзБржХрзНржд рж░рж╛ржЦрж╛ ржЙржЪрж┐ржд ржиржпрж╝ред ржЖржкржирж╛рж░ AI ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЦрж╛ ржЕрждрзНржпрж╛ржмрж╢рзНржпржХ ржпрж╛рждрзЗ ржЖржкржирж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА, ржмрж┐рж╢рзНржмрж╛рж╕ржпрзЛржЧрзНржп ржПржмржВ ржирж┐рж░рж╛ржкржж ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржПржЗ ржЕржзрзНржпрж╛ржпрж╝рзЗ Microsoft Entra ID ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐ рж╢рзЗржЦрж╛ржирзЛ рж╣ржмрзЗ, ржпрж╛рждрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕржирзБржорзЛржжрж┐ржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржмржВ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЗ ржЖржкржирж╛рж░ ржЯрзБрж▓ ржПржмржВ ржбрзЗржЯрж╛рж░ рж╕рж╛ржерзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

## MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржХрзЗржи ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг

ржзрж░рзБржи ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржПржоржи ржПржХржЯрж┐ ржЯрзБрж▓ ржЖржЫрзЗ ржпрж╛ ржЗржорзЗржЗрж▓ ржкрж╛ржарж╛рждрзЗ ржкрж╛рж░рзЗ ржмрж╛ ржЧрзНрж░рж╛рж╣ржХрзЗрж░ ржбрзЗржЯрж╛ржмрзЗрж╕ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржпржжрж┐ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржирж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржпрзЗржХрзЗржЙ рж╕рзЗржЗ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ, ржпрж╛рж░ ржлрж▓рзЗ ржЕржиржирзБржорзЛржжрж┐ржд ржбрзЗржЯрж╛ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕, рж╕рзНржкрзНржпрж╛ржо ржмрж╛ ржЕржирзНржпрж╛ржирзНржп ржХрзНрж╖рждрж┐ржХрж░ ржХрж╛рж░рзНржпржХрж▓рж╛ржк ржШржЯрждрзЗ ржкрж╛рж░рзЗред

ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзЗ, ржЖржкржирж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗржи ржпрзЗ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржЕржирзБрж░рзЛржз ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣ржпрж╝, ржЕрж░рзНржерж╛рзО ржЕржирзБрж░рзЛржзржХрж╛рж░рзА ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржмрж╛ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржкрж░рж┐ржЪржпрж╝ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ рж╣ржпрж╝ред ржПржЯрж┐ ржЖржкржирж╛рж░ AI ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ рж╕рзБрж░ржХрзНрж╖рж╛рж░ ржкрзНрж░ржержо ржПржмржВ рж╕ржмржЪрзЗржпрж╝рзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржзрж╛ржкред

## Microsoft Entra ID ржкрж░рж┐ржЪрж┐рждрж┐

[**Microsoft Entra ID**](https://adoption.microsoft.com/microsoft-security/entra/) ржПржХржЯрж┐ ржХрзНрж▓рж╛ржЙржб-ржнрж┐рждрзНрждрж┐ржХ ржкрж░рж┐ржЪржпрж╝ ржУ ржкрзНрж░ржмрзЗрж╢рж╛ржзрж┐ржХрж╛рж░ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛ рж╕рзЗржмрж╛ред ржПржЯрж┐ржХрзЗ ржнрж╛ржмрзБржи ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржиржЧрзБрж▓рзЛрж░ ржЬржирзНржп ржПржХржЯрж┐ рж╕рж╛рж░рзНржмржЬржирзАржи ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржкрзНрж░рж╣рж░рзА рж╣рж┐рж╕рзЗржмрзЗред ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрж░рж┐ржЪржпрж╝ ржпрж╛ржЪрж╛ржЗ (ржкрзНрж░ржорж╛ржгрзАржХрж░ржг) ржПржмржВ рждрж╛рж░рж╛ ржХрзА ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг (ржЕржирзБржорзЛржжржи) ржХрж░рж╛рж░ ржЬржЯрж┐рж▓ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

Entra ID ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж┐:

- ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЬржирзНржп ржирж┐рж░рж╛ржкржж рж╕рж╛ржЗржи-ржЗржи рж╕ржХрзНрж╖ржо ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
- API ржПржмржВ рж╕рж╛рж░рзНржнрж┐рж╕ржЧрзБрж▓рзЛ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЦрждрзЗ ржкрж╛рж░рзЗржиред
- ржХрзЗржирзНржжрзНрж░рзАржпрж╝ рж╕рзНржерж╛ржирзЗ ржерзЗржХрзЗ ржкрзНрж░ржмрзЗрж╢рж╛ржзрж┐ржХрж╛рж░ ржирзАрждрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп, Entra ID ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржПржмржВ ржмрзНржпрж╛ржкржХржнрж╛ржмрзЗ ржмрж┐рж╢рзНржмрж╛рж╕ржпрзЛржЧрзНржп рж╕ржорж╛ржзрж╛ржи ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ, ржпрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗ ржХрзЗ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржХрзНрж╖ржорждрж╛ржЧрзБрж▓рзЛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред

---

## Entra ID ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ: ржПржХржЯрж┐ рж╕рж╣ржЬ ржмрзНржпрж╛ржЦрзНржпрж╛

Entra ID ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржЬржирзНржп **OAuth 2.0** ржПрж░ ржорждрзЛ ржУржкрзЗржи рж╕рзНржЯрзНржпрж╛ржирзНржбрж╛рж░рзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржпржжрж┐ржУ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЬржЯрж┐рж▓ рж╣рждрзЗ ржкрж╛рж░рзЗ, ржорзВрж▓ ржзрж╛рж░ржгрж╛ржЯрж┐ рж╕рж╣ржЬ ржПржмржВ ржПржХржЯрж┐ ржЙржкржорж╛ ржжрж┐ржпрж╝рзЗ ржмрзЛржЭрж╛ ржпрж╛ржпрж╝ред

### OAuth 2.0 ржПрж░ рж╕рж╣ржЬ ржкрж░рж┐ржЪрж┐рждрж┐: ржнрзНржпрж╛рж▓рзЗржЯ ржХрзА

OAuth 2.0 ржХрзЗ ржнрж╛ржмрзБржи ржЖржкржирж╛рж░ ржЧрж╛ржбрж╝рж┐рж░ ржЬржирзНржп ржПржХржЯрж┐ ржнрзНржпрж╛рж▓рзЗржЯ рж╕рж╛рж░рзНржнрж┐рж╕ рж╣рж┐рж╕рзЗржмрзЗред ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯрзЗ ржпрж╛ржи, ржЖржкржирж┐ ржЖржкржирж╛рж░ ржорж╛рж╕рзНржЯрж╛рж░ ржХрзА ржнрзНржпрж╛рж▓рзЗржЯржХрзЗ ржжрзЗржи ржирж╛ред ржкрж░рж┐ржмрж░рзНрждрзЗ, ржЖржкржирж┐ ржПржХржЯрж┐ **ржнрзНржпрж╛рж▓рзЗржЯ ржХрзА** ржжрзЗржи ржпрж╛рж░ рж╕рзАржорж┐ржд ржЕржирзБржорждрж┐ ржерж╛ржХрзЗтАФржПржЯрж┐ ржЧрж╛ржбрж╝рж┐ ржЪрж╛рж▓рзБ ржХрж░рждрзЗ ржПржмржВ ржжрж░ржЬрж╛ рж▓ржХ ржХрж░рждрзЗ ржкрж╛рж░рзЗ, ржХрж┐ржирзНрждрзБ ржЯрзНрж░рж╛ржЩрзНржХ ржмрж╛ ржЧрзНрж▓рж╛ржн ржХржорзНржкрж╛рж░рзНржЯржорзЗржирзНржЯ ржЦрзБрж▓рждрзЗ ржкрж╛рж░рзЗ ржирж╛ред

ржПржЗ ржЙржкржорж╛ржпрж╝:

- **ржЖржкржирж┐** рж╣ржЪрзНржЫрзЗржи **ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА**ред
- **ржЖржкржирж╛рж░ ржЧрж╛ржбрж╝рж┐** MCP рж╕рж╛рж░рзНржнрж╛рж░, ржпрж╛рж░ ржорзВрж▓рзНржпржмрж╛ржи ржЯрзБрж▓ ржПржмржВ ржбрзЗржЯрж╛ рж░ржпрж╝рзЗржЫрзЗред
- **ржнрзНржпрж╛рж▓рзЗржЯ** рж╣рж▓ **Microsoft Entra ID**ред
- **ржкрж╛рж░рзНржХрж┐ржВ ржЕрзНржпрж╛ржЯрзЗржиржбрзЗржирзНржЯ** рж╣рж▓ MCP ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ (ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржпрж╛ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЪрж╛ржпрж╝)ред
- **ржнрзНржпрж╛рж▓рзЗржЯ ржХрзА** рж╣рж▓ **ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи**ред

ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи ржПржХржЯрж┐ ржирж┐рж░рж╛ржкржж ржЯрзЗржХрзНрж╕ржЯ рж╕рзНржЯрзНрж░рж┐ржВ ржпрж╛ MCP ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ Entra ID ржерзЗржХрзЗ рж╕рж╛ржЗржи-ржЗржи ржХрж░рж╛рж░ ржкрж░ ржкрж╛ржпрж╝ред ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржПржЗ ржЯрзЛржХрзЗржи MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржЕржирзБрж░рзЛржзрзЗрж░ рж╕рж╛ржерзЗ ржкрж╛ржарж╛ржпрж╝ред рж╕рж╛рж░рзНржнрж╛рж░ ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржЕржирзБрж░рзЛржз ржмрзИржз ржПржмржВ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯрзЗрж░ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржЕржирзБржорждрж┐ ржЖржЫрзЗ, рж╕ржмржЗ ржЖржкржирж╛рж░ ржЖрж╕рж▓ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ (ржпрзЗржоржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб) ржЫрж╛ржбрж╝рж╛ржЗред

### ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░ржмрж╛рж╣

ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржЯрж┐ ржмрж╛рж╕рзНрждржмрзЗ ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:

```mermaid
sequenceDiagram
    actor User as ЁЯСд User
    participant Client as ЁЯЦея╕П MCP Client
    participant Entra as ЁЯФР Microsoft Entra ID
    participant Server as ЁЯФз MCP Server

    Client->>+User: Please sign in to continue.
    User->>+Entra: Enters credentials (username/password).
    Entra-->>Client: Here is your access token.
    User-->>-Client: (Returns to the application)

    Client->>+Server: I need to use a tool. Here is my access token.
    Server->>+Entra: Is this access token valid?
    Entra-->>-Server: Yes, it is.
    Server-->>-Client: Token is valid. Here is the result of the tool.
```

### Microsoft Authentication Library (MSAL) ржкрж░рж┐ржЪрж┐рждрж┐

ржХрзЛржбрзЗ ржпрж╛ржУржпрж╝рж╛рж░ ржЖржЧрзЗ, ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЙржкрж╛ржжрж╛ржи ржкрж░рж┐ржЪржпрж╝ ржХрж░рж┐ржпрж╝рзЗ ржжрзЗржУржпрж╝рж╛ ржжрж░ржХрж╛рж░: **Microsoft Authentication Library (MSAL)**ред

MSAL рж╣рж▓ Microsoft ржжрзНржмрж╛рж░рж╛ рждрзИрж░рж┐ ржПржХржЯрж┐ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржпрж╛ ржбрзЗржнрзЗрж▓ржкрж╛рж░ржжрзЗрж░ ржЬржирзНржп ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржЕржирзЗржХ рж╕рж╣ржЬ ржХрж░рзЗ рждрзЛрж▓рзЗред ржЖржкржирж╛ржХрзЗ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржЯрзЛржХрзЗржи, рж╕рж╛ржЗржи-ржЗржи ржПржмржВ рж╕рзЗрж╢ржи рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рж╛рж░ ржЬржЯрж┐рж▓ ржХрзЛржб рж▓рзЗржЦрж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ, MSAL ржПржЗ ржХрж╛ржЬржЧрзБрж▓рзЛ ржХрж░рзЗ ржжрзЗржпрж╝ред

MSAL ржмрзНржпржмрж╣рж╛рж░рзЗрж░ рж╕рзБржмрж┐ржзрж╛:

- **ржирж┐рж░рж╛ржкржж:** ржПржЯрж┐ рж╢рж┐рж▓рзНржк-ржорж╛ржирзЗрж░ ржкрзНрж░рзЛржЯрзЛржХрж▓ ржПржмржВ ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи ржЕржирзБрж╕рж░ржг ржХрж░рзЗ, ржЖржкржирж╛рж░ ржХрзЛржбрзЗ ржжрзБрж░рзНржмрж▓рждрж╛рж░ ржЭрзБржБржХрж┐ ржХржорж╛ржпрж╝ред
- **рж╕рж╣ржЬ ржЙржирзНржиржпрж╝ржи:** OAuth 2.0 ржПржмржВ OpenID Connect ржкрзНрж░рзЛржЯрзЛржХрж▓рзЗрж░ ржЬржЯрж┐рж▓рждрж╛ рж▓рзБржХрж┐ржпрж╝рзЗ рж░рж╛ржЦрзЗ, ржХржпрж╝рзЗржХ рж▓рж╛ржЗржирзЗрж░ ржХрзЛржбрзЗ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржпрзЛржЧ ржХрж░рждрзЗ ржжрзЗржпрж╝ред
- **рж░ржХрзНрж╖ржгрж╛ржмрзЗржХрзНрж╖ржг:** Microsoft ржирж┐ржпрж╝ржорж┐ржд MSAL ржЖржкржбрзЗржЯ ржХрж░рзЗ ржирждрзБржи ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╣рзБржоржХрж┐ ржПржмржВ ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржо ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ рж╕рж╛ржерзЗ ржЦрж╛ржк ржЦрж╛ржЗржпрж╝рзЗ ржирж┐рждрзЗред

MSAL .NET, JavaScript/TypeScript, Python, Java, Go ржПржмржВ ржорзЛржмрж╛ржЗрж▓ ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржо ржпрзЗржоржи iOS ржУ Android рж╕рж╣ ржмрж┐ржнрж┐ржирзНржи ржнрж╛рж╖рж╛ ржУ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХ рж╕ржорж░рзНржержи ржХрж░рзЗред ржПрж░ ржорж╛ржирзЗ ржЖржкржирж┐ ржЖржкржирж╛рж░ ржкрзНрж░ржпрзБржХрзНрждрж┐ рж╕рзНржЯрзНржпрж╛ржХ ржЬрзБржбрж╝рзЗ ржПржХржЗ ржзрж╛рж░рж╛ржмрж╛рж╣рж┐ржХ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред

MSAL рж╕ржорзНржкрж░рзНржХрзЗ ржЖрж░ржУ ржЬрж╛ржирждрзЗ, ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ [MSAL ржУржнрж╛рж░ржнрж┐ржЙ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи](https://learn.microsoft.com/entra/identity-platform/msal-overview) ржжрзЗржЦрзБржиред

---

## Entra ID ржжрж┐ржпрж╝рзЗ ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рж╛: ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛

ржПржЦржи, ржЪрж▓рзБржи ржжрзЗржЦрж┐ ржХрж┐ржнрж╛ржмрзЗ рж╕рзНржерж╛ржирзАржпрж╝ MCP рж╕рж╛рж░рзНржнрж╛рж░ (ржпрж╛ `stdio` ржПрж░ ржорж╛ржзрзНржпржорзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзЗ) Entra ID ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рж╛ ржпрж╛ржпрж╝ред ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ ржПржХржЯрж┐ **ржкрж╛ржмрж▓рж┐ржХ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржорзЗрж╢рж┐ржирзЗ ржЪрж▓рж╛ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп ржЙржкржпрзБржХрзНржд, ржпрзЗржоржи ржбрзЗрж╕рзНржХржЯржк ржЕрзНржпрж╛ржк ржмрж╛ рж╕рзНржерж╛ржирзАржпрж╝ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ рж╕рж╛рж░рзНржнрж╛рж░ред

### ржкрж░рж┐рж╕рзНржерж┐рждрж┐ рзз: рж╕рзНржерж╛ржирзАржпрж╝ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж╛ (ржкрж╛ржмрж▓рж┐ржХ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ рж╕рж╣)

ржПржЗ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рждрзЗ, ржЖржорж░рж╛ ржПржХржЯрж┐ рж╕рзНржерж╛ржирзАржпрж╝ MCP рж╕рж╛рж░рзНржнрж╛рж░ ржжрзЗржЦржм ржпрж╛ `stdio` ржПрж░ ржорж╛ржзрзНржпржорзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзЗ ржПржмржВ Entra ID ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржХрж░рзЗ рждрж╛рж░ ржЯрзБрж▓ржЧрзБрж▓рзЛрждрзЗ ржкрзНрж░ржмрзЗрж╢рж╛ржзрж┐ржХрж╛рж░ ржжрзЗржпрж╝ред рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржПржХржЯрж┐ ржЯрзБрж▓ ржерж╛ржХржмрзЗ ржпрж╛ Microsoft Graph API ржерзЗржХрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрзНрж░рзЛржлрж╛ржЗрж▓ рждржерзНржп ржирж┐ржпрж╝рзЗ ржЖрж╕рзЗред

#### рзз. Entra ID рждрзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж╕рзЗржЯржЖржк ржХрж░рж╛

ржХрзЛржи ржХрзЛржб рж▓рзЗржЦрж╛рж░ ржЖржЧрзЗ, ржЖржкржирж╛ржХрзЗ Microsoft Entra ID рждрзЗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржирж┐ржмржирзНржзржи ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЯрж┐ Entra ID ржХрзЗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж╕ржорзНржкрж░рзНржХрзЗ ржЬрж╛ржирж╛ржпрж╝ ржПржмржВ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕рзЗржмрж╛ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЕржирзБржорждрж┐ ржжрзЗржпрж╝ред

1. **[Microsoft Entra ржкрзЛрж░рзНржЯрж╛рж▓](https://entra.microsoft.com/)** ржП ржпрж╛ржиред
2. **App registrations** ржП ржпрж╛ржи ржПржмржВ **New registration** ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред
3. ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржирж╛ржо ржжрж┐ржи (ржпрзЗржоржи "My Local MCP Server")ред
4. **Supported account types** ржП **Accounts in this organizational directory only** ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржиред
5. ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗрж░ ржЬржирзНржп **Redirect URI** ржлрж╛ржБржХрж╛ рж░рж╛ржЦрждрзЗ ржкрж╛рж░рзЗржиред
6. **Register** ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред

ржирж┐ржмржирзНржзржирзЗрж░ ржкрж░, **Application (client) ID** ржПржмржВ **Directory (tenant) ID** ржирзЛржЯ ржХрж░рзЗ рж░рж╛ржЦрзБржиред ржПржЧрзБрж▓рзЛ ржХрзЛржбрзЗ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржмрзЗред

#### рзи. ржХрзЛржб: ржПржХржЯрж┐ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

ржЪрж▓рзБржи ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрж░рж┐ржЪрж╛рж▓ржирж╛рж░ ржорзВрж▓ ржЕржВрж╢ржЧрзБрж▓рзЛ ржжрзЗржЦрж┐ред ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗрж░ рж╕ржорзНржкрзВрж░рзНржг ржХрзЛржб [Entra ID - Local - WAM](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-local-wam) ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ [mcp-auth-servers GitHub рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рждрзЗ](https://github.com/Azure-Samples/mcp-auth-servers)ред

**`AuthenticationService.cs`**

ржПржЗ ржХрзНрж▓рж╛рж╕ Entra ID ржПрж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж╛рж░ржЕрзНржпрж╛ржХрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

- **`CreateAsync`**: MSAL ржерзЗржХрзЗ `PublicClientApplication` ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рзЗред ржПржЯрж┐ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ `clientId` ржПржмржВ `tenantId` ржжрж┐ржпрж╝рзЗ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ рж╣ржпрж╝ред
- **`WithBroker`**: ржмрзНрж░рзЛржХрж╛рж░ (ржпрзЗржоржи Windows Web Account Manager) ржмрзНржпржмрж╣рж╛рж░ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзЗ, ржпрж╛ ржЖрж░ржУ ржирж┐рж░рж╛ржкржж ржПржмржВ рж╕рж┐ржорж▓рзЗрж╕ рж╕рж┐ржЩрзНржЧрж▓ рж╕рж╛ржЗржи-ржЕржи ржЕржнрж┐ржЬрзНржЮрждрж╛ ржжрзЗржпрж╝ред
- **`AcquireTokenAsync`**: ржорзВрж▓ ржорзЗржержбред ржкрзНрж░ржержорзЗ ржПржЯрж┐ рж╕рж╛ржЗрж▓рзЗржирзНржЯрж▓рж┐ ржЯрзЛржХрзЗржи ржкрж╛ржУржпрж╝рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЗ (ржпржжрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрзИржз рж╕рзЗрж╢ржи ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржкрзБржирж░рж╛ржпрж╝ рж╕рж╛ржЗржи-ржЗржи ржХрж░рждрзЗ рж╣ржпрж╝ ржирж╛)ред ржпржжрж┐ рж╕рж╛ржЗрж▓рзЗржирзНржЯ ржЯрзЛржХрзЗржи ржирж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝, рждрж╛рж╣рж▓рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржЗржирзНржЯрж╛рж░рзЗржХрзНржЯрж┐ржн рж╕рж╛ржЗржи-ржЗржирзЗрж░ ржЬржирзНржп ржЕржирзБрж░рзЛржз ржХрж░рзЗред

```csharp
// Simplified for clarity
public static async Task<AuthenticationService> CreateAsync(ILogger<AuthenticationService> logger)
{
    var msalClient = PublicClientApplicationBuilder
        .Create(_clientId) // Your Application (client) ID
        .WithAuthority(AadAuthorityAudience.AzureAdMyOrg)
        .WithTenantId(_tenantId) // Your Directory (tenant) ID
        .WithBroker(new BrokerOptions(BrokerOptions.OperatingSystems.Windows))
        .Build();

    // ... cache registration ...

    return new AuthenticationService(logger, msalClient);
}

public async Task<string> AcquireTokenAsync()
{
    try
    {
        // Try silent authentication first
        var accounts = await _msalClient.GetAccountsAsync();
        var account = accounts.FirstOrDefault();

        AuthenticationResult? result = null;

        if (account != null)
        {
            result = await _msalClient.AcquireTokenSilent(_scopes, account).ExecuteAsync();
        }
        else
        {
            // If no account, or silent fails, go interactive
            result = await _msalClient.AcquireTokenInteractive(_scopes).ExecuteAsync();
        }

        return result.AccessToken;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "An error occurred while acquiring the token.");
        throw; // Optionally rethrow the exception for higher-level handling
    }
}
```

**`Program.cs`**

ржПржЦрж╛ржирзЗ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЯржЖржк ржПржмржВ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕рж╛рж░рзНржнрж┐рж╕ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рж╛ рж╣ржпрж╝ред

- **`AddSingleton<AuthenticationService>`**: `AuthenticationService` ржХрзЗ ржбрж┐ржкрзЗржиржбрзЗржирзНрж╕рж┐ ржЗржиржЬрзЗржХрж╢ржи ржХржирзНржЯрзЗржЗржирж╛рж░рзЗ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржХрж░рзЗ, ржпрж╛рждрзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЕржирзНржпрж╛ржирзНржп ржЕржВрж╢ (ржпрзЗржоржи ржЯрзБрж▓) ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗред
- **`GetUserDetailsFromGraph` ржЯрзБрж▓**: ржПржЗ ржЯрзБрж▓ `AuthenticationService` ржПрж░ ржПржХржЯрж┐ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ ржЪрж╛ржпрж╝ред ржПржЯрж┐ ржкрзНрж░ржержорзЗ `authService.AcquireTokenAsync()` ржХрж▓ ржХрж░рзЗ ржмрзИржз ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи ржкрж╛ржпрж╝ред ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕ржлрж▓ рж╣рж▓рзЗ, ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Microsoft Graph API ржХрж▓ ржХрж░рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рждржерзНржп ржЖржирзЗред

```csharp
// Simplified for clarity
[McpServerTool(Name = "GetUserDetailsFromGraph")]
public static async Task<string> GetUserDetailsFromGraph(
    AuthenticationService authService)
{
    try
    {
        // This will trigger the authentication flow
        var accessToken = await authService.AcquireTokenAsync();

        // Use the token to create a GraphServiceClient
        var graphClient = new GraphServiceClient(
            new BaseBearerTokenAuthenticationProvider(new TokenProvider(authService)));

        var user = await graphClient.Me.GetAsync();

        return System.Text.Json.JsonSerializer.Serialize(user);
    }
    catch (Exception ex)
    {
        return $"Error: {ex.Message}";
    }
}
```

#### рзй. рж╕ржмржХрж┐ржЫрзБ ржХрж┐ржнрж╛ржмрзЗ ржПржХрж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рзЗ

1. MCP ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржпржЦржи `GetUserDetailsFromGraph` ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржпрж╝, ржЯрзБрж▓ ржкрзНрж░ржержорзЗ `AcquireTokenAsync` ржХрж▓ ржХрж░рзЗред
2. `AcquireTokenAsync` MSAL рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ржХрзЗ ржмрзИржз ржЯрзЛржХрзЗржи ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рждрзЗ ржмрж▓рзЗред
3. ржпржжрж┐ ржЯрзЛржХрзЗржи ржирж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝, MSAL ржмрзНрж░рзЛржХрж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ Entra ID ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржжрж┐ржпрж╝рзЗ рж╕рж╛ржЗржи-ржЗржи ржХрж░рждрзЗ ржмрж▓рзЗред
4. ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕рж╛ржЗржи-ржЗржи ржХрж░рж▓рзЗ, Entra ID ржПржХржЯрж┐ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи ржЗрж╕рзНржпрзБ ржХрж░рзЗред
5. ржЯрзБрж▓ ржЯрзЛржХрзЗржи ржкрзЗржпрж╝рзЗ Microsoft Graph API-рждрзЗ ржирж┐рж░рж╛ржкржж ржХрж▓ ржХрж░рзЗред
6. ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рждржерзНржп MCP ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯржХрзЗ ржлрзЗрж░ржд ржжрзЗржпрж╝ред

ржПржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржкрзНрж░ржорж╛ржгрзАржХрзГржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░рж╛ржЗ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗ, ржлрж▓рзЗ ржЖржкржирж╛рж░ рж╕рзНржерж╛ржирзАржпрж╝ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржерж╛ржХрзЗред

### ржкрж░рж┐рж╕рзНржерж┐рждрж┐ рзи: рж░рж┐ржорзЛржЯ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж╛ (ржХржиржлрж┐ржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ рж╕рж╣)

ржпржЦржи ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж░рж┐ржорзЛржЯ ржорзЗрж╢рж┐ржирзЗ (ржпрзЗржоржи ржХрзНрж▓рж╛ржЙржб рж╕рж╛рж░рзНржнрж╛рж░) ржЪрж▓рзЗ ржПржмржВ HTTP Streaming ржПрж░ ржорждрзЛ ржкрзНрж░рзЛржЯрзЛржХрж▓рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзЗ, рждржЦржи ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЪрж╛рж╣рж┐ржжрж╛ ржЖрж▓рж╛ржжрж╛ рж╣ржпрж╝ред ржПржЗ ржХрзНрж╖рзЗрждрзНрж░рзЗ, ржЖржкржирж╛ржХрзЗ **ржХржиржлрж┐ржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ** ржПржмржВ **Authorization Code Flow** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЯрж┐ ржЖрж░ржУ ржирж┐рж░рж╛ржкржж ржХрж╛рж░ржг ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ рж╕рж┐ржХрзНрж░рзЗржЯ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржХржЦржирзЛ ржкрзНрж░ржХрж╛рж╢ ржкрж╛ржпрж╝ ржирж╛ред

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ TypeScript ржнрж┐рждрзНрждрж┐ржХ MCP рж╕рж╛рж░рзНржнрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, ржпрж╛ Express.js ржжрж┐ржпрж╝рзЗ HTTP ржЕржирзБрж░рзЛржз ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

#### рзз. Entra ID рждрзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж╕рзЗржЯржЖржк ржХрж░рж╛

Entra ID рждрзЗ рж╕рзЗржЯржЖржк ржкрж╛ржмрж▓рж┐ржХ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯрзЗрж░ ржорждрзЛржЗ, рждржмрзЗ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржкрж╛рж░рзНржержХрзНржп ржЖржЫрзЗ: ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ **client secret** рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗред

1. **[Microsoft Entra ржкрзЛрж░рзНржЯрж╛рж▓](https://entra.microsoft.com/)** ржП ржпрж╛ржиред
2. ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржк ржирж┐ржмржирзНржзржирзЗ **Certificates & secrets** ржЯрзНржпрж╛ржмрзЗ ржпрж╛ржиред
3. **New client secret** ржХрзНрж▓рж┐ржХ ржХрж░рзБржи, ржПржХржЯрж┐ ржмрж░рзНржгржирж╛ ржжрж┐ржи ржПржмржВ **Add** ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред
4. **ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг:** рж╕рж┐ржХрзНрж░рзЗржЯ ржорж╛ржиржЯрж┐ ржЕржмрж┐рж▓ржорзНржмрзЗ ржХржкрж┐ ржХрж░рзЗ рж░рж╛ржЦрзБржиред ржкрж░рзЗ ржПржЯрж┐ ржЖрж░ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗ ржирж╛ред
5. ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ **Redirect URI** ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред **Authentication** ржЯрзНржпрж╛ржмрзЗ ржпрж╛ржи, **Add a platform** ржХрзНрж▓рж┐ржХ ржХрж░рзБржи, **Web** ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи ржПржмржВ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ URI ржжрж┐ржи (ржпрзЗржоржи `http://localhost:3001/auth/callback`)ред

> **тЪая╕П ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржирзЛржЯ:** ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп, Microsoft ржжрзГржврж╝ржнрж╛ржмрзЗ ржкрж░рж╛ржорж░рзНрж╢ ржжрзЗржпрж╝ **secretless authentication** ржкржжрзНржзрждрж┐ ржпрзЗржоржи **Managed Identity** ржмрж╛ **Workload Identity Federation** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗред ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ рж╕рж┐ржХрзНрж░рзЗржЯ ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЭрзБржБржХрж┐ рж╕рзГрж╖рзНржЯрж┐ ржХрж░рзЗ ржХрж╛рж░ржг ржПржЯрж┐ ржкрзНрж░ржХрж╛рж╢ ржмрж╛ ржХржорзНржкрзНрж░рзЛржорж╛ржЗржЬ рж╣рждрзЗ ржкрж╛рж░рзЗред Managed identity ржЧрзБрж▓рзЛ ржирж┐рж░рж╛ржкржж ржкржжрзНржзрждрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ ржХрж╛рж░ржг ржПрждрзЗ ржЖржкржирж╛рж░ ржХрзЛржб ржмрж╛ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржирзЗ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рждрзЗ рж╣ржпрж╝ ржирж╛ред
>
> Managed identities ржПржмржВ рждрж╛ржжрзЗрж░ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи рж╕ржорзНржкрж░рзНржХрзЗ ржЖрж░ржУ ржЬрж╛ржирждрзЗ, ржжрзЗржЦрзБржи [Managed identities for Azure resources overview](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview)ред

#### рзи. ржХрзЛржб: ржПржХржЯрж┐ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ рж╕рзЗрж╢ржи-ржнрж┐рждрзНрждрж┐ржХ ржкржжрзНржзрждрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржорж╛ржгрзАржХрзГржд рж╣рж▓рзЗ, рж╕рж╛рж░рзНржнрж╛рж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи ржПржмржВ рж░рж┐ржлрзНрж░рзЗрж╢ ржЯрзЛржХрзЗржи рж╕рзЗрж╢ржирзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржПржХржЯрж┐ рж╕рзЗрж╢ржи ржЯрзЛржХрзЗржи ржжрзЗржпрж╝ред ржкрж░ржмрж░рзНрждрзА ржЕржирзБрж░рзЛржзрзЗ ржПржЗ рж╕рзЗрж╢ржи ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝ред рж╕ржорзНржкрзВрж░рзНржг ржХрзЛржб [Entra ID - Confidential client](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-cca-session) ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ [mcp-auth-servers GitHub рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рждрзЗ](https://github.com/Azure-Samples/mcp-auth-servers)ред

**`Server.ts`**

ржПржЗ ржлрж╛ржЗрж▓ржЯрж┐ Express рж╕рж╛рж░рзНржнрж╛рж░ ржПржмржВ MCP ржЯрзНрж░рж╛ржирзНрж╕ржкрзЛрж░рзНржЯ рж▓рзЗржпрж╝рж╛рж░ рж╕рзЗржЯржЖржк ржХрж░рзЗред

- **`requireBearerAuth`**: ржПржЯрж┐ ржПржХржЯрж┐ ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржпрж╛ `/sse` ржПржмржВ `/message` ржПржирзНржбржкржпрж╝рзЗржирзНржЯржЧрзБрж▓рзЛ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рзЗред ржПржЯрж┐ ржЕржирзБрж░рзЛржзрзЗрж░ `Authorization` рж╣рзЗржбрж╛рж░рзЗ ржмрзИржз ржмрзЗржпрж╝рж╛рж░рж╛рж░ ржЯрзЛржХрзЗржи ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзЗред
- **`EntraIdServerAuthProvider`**: ржПржХржЯрж┐ ржХрж╛рж╕рзНржЯржо ржХрзНрж▓рж╛рж╕ ржпрж╛ `McpServerAuthorizationProvider` ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ ржЗржоржкрзНрж▓рж┐ржорзЗржирзНржЯ ржХрж░рзЗред ржПржЯрж┐ OAuth 2.0 ржлрзНрж▓рзЛ ржкрж░рж┐ржЪрж╛рж▓ржирж╛рж░ ржжрж╛ржпрж╝рж┐рждрзНржмрзЗ ржерж╛ржХрзЗред
- **`/auth/callback`**: ржПржЗ ржПржирзНржбржкржпрж╝рзЗржирзНржЯ Entra ID ржерзЗржХрзЗ ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржкрж░ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рзЗред ржПржЯрж┐ authorization code ржХрзЗ access token ржПржмржВ refresh token ржП рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рзЗред

```typescript
// Simplified for clarity
const app = express();
const { server } = createServer();
const provider = new EntraIdServerAuthProvider();

// Protect the SSE endpoint
app.get("/sse", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... connect to the transport ...
});

// Protect the message endpoint
app.post("/message", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... handle the message ...
});

// Handle the OAuth 2.0 callback
app.get("/auth/callback", (req, res) => {
  provider.handleCallback(req.query.code, req.query.state)
    .then(result => {
      // ... handle success or failure ...
    });
});
```

**`Tools.ts`**

ржПржЗ ржлрж╛ржЗрж▓рзЗ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж╕рж░ржмрж░рж╛рж╣ржХрзГржд ржЯрзБрж▓ржЧрзБрж▓рзЛ рж╕ржВржЬрзНржЮрж╛ржпрж╝рж┐ржд ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред `getUserDetails` ржЯрзБрж▓ржЯрж┐ ржЖржЧрзЗрж░ ржЙржжрж╛рж╣рж░ржгрзЗрж░ ржорждрзЛржЗ, рждржмрзЗ ржПржЯрж┐ рж╕рзЗрж╢ржи ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи ржирзЗржпрж╝ред

```typescript
// Simplified for clarity
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name } = request.params;
  const context = request.params?.context as { token?: string } | undefined;
  const sessionToken = context?.token;

  if (name === ToolName.GET_USER_DETAILS) {
    if (!sessionToken) {
      throw new AuthenticationError("Authentication token is missing or invalid. Ensure the token is provided in the request context.");
    }

    // Get the Entra ID token from the session store
    const tokenData = tokenStore.getToken(sessionToken);
    const entraIdToken = tokenData.accessToken;

    const graphClient = Client.init({
      authProvider: (done) => {
        done(null, entraIdToken);
      }
    });

    const user = await graphClient.api('/me').get();

    // ... return user details ...
  }
});
```

**`auth/EntraIdServerAuthProvider.ts`**

ржПржЗ ржХрзНрж▓рж╛рж╕рзЗрж░ ржХрж╛ржЬ:

- ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ Entra ID рж╕рж╛ржЗржи-ржЗржи ржкрзЗржЬрзЗ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░рж╛ред
- authorization code ржХрзЗ access token ржП рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рж╛ред
- ржЯрзЛржХрзЗржиржЧрзБрж▓рзЛ `tokenStore` ржП рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ред
- ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржирзЗрж░ ржорзЗржпрж╝рж╛ржж рж╢рзЗрж╖ рж╣рж▓рзЗ рждрж╛ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рж╛ред

#### рзй. рж╕ржмржХрж┐ржЫрзБ ржХрж┐ржнрж╛ржмрзЗ ржПржХрж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рзЗ

1. ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржержо MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕ржВржпрзЛржЧ ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЗ, `requireBearerAuth` ржорж┐ржбрж▓ржУржпрж╝рзНржпрж╛рж░ ржжрзЗржЦрзЗ ржпрзЗ ржмрзИржз рж╕рзЗрж╢ржи ржирзЗржЗ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ Entra ID рж╕рж╛ржЗржи-ржЗржи ржкрзЗржЬрзЗ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░рзЗред
2. ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрж╛рж░ Entra ID ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржжрж┐ржпрж╝рзЗ рж╕рж╛ржЗржи-ржЗржи ржХрж░рзЗред
3. Entra ID ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ `/auth/callback` ржПржирзНржбржкржпрж╝рзЗржирзНржЯрзЗ authorization code рж╕рж╣ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░рзЗред
4. рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЛржбрзЗрж░ ржмрж┐ржирж┐ржоржпрж╝рзЗ ржПржХржЯрж┐ access token ржПржмржВ refresh token ржЧрзНрж░рж╣ржг ржХрж░рзЗ, рж╕рзЗржЧрзБрж▓рзЛ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ ржПржмржВ ржПржХржЯрж┐ session token рждрзИрж░рж┐ ржХрж░рзЗ ржпрж╛ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯржХрзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝ред  
5. ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржПржЦржи ржПржЗ session token ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж╕ржХрж▓ ржнржмрж┐рж╖рзНржпржд ржЕржирзБрж░рзЛржзрзЗ `Authorization` рж╣рзЗржбрж╛рж░рзЗ ржПржЯрж┐ ржкрж╛ржарж╛рждрзЗ ржкрж╛рж░рзЗред  
6. ржпржЦржи `getUserDetails` ржЯрзБрж▓ ржХрж▓ ржХрж░рж╛ рж╣ржпрж╝, рждржЦржи ржПржЯрж┐ session token ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Entra ID access token ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рзЗ ржПржмржВ рждрж╛рж░ржкрж░ Microsoft Graph API ржХрж▓ ржХрж░рзЗред  

ржПржЗ ржкрзНрж░ржмрж╛рж╣ржЯрж┐ public client flow ржерзЗржХрзЗ ржмрзЗрж╢рж┐ ржЬржЯрж┐рж▓, рждржмрзЗ ржЗржирзНржЯрж╛рж░ржирзЗржЯ-ржлрзЗрж╕рж┐ржВ ржПржирзНржбржкржпрж╝рзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржПржЯрж┐ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ред ржпрзЗрж╣рзЗрждрзБ рж░рж┐ржорзЛржЯ MCP рж╕рж╛рж░рзНржнрж╛рж░ржЧрзБрж▓рзЛ ржкрж╛ржмрж▓рж┐ржХ ржЗржирзНржЯрж╛рж░ржирзЗржЯрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп, рждрж╛ржЗ ржЕржиржирзБржорзЛржжрж┐ржд ржкрзНрж░ржмрзЗрж╢ ржПржмржВ рж╕ржорзНржнрж╛ржмрзНржп ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ рж╕рзБрж░ржХрзНрж╖рж╛рж░ ржЬржирзНржп рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрзНржпржмрж╕рзНржерж╛ ржкрзНрж░ржпрж╝рзЛржЬржиред  


## Security Best Practices

- **рж╕ржмрж╕ржоржпрж╝ HTTPS ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи**: ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржПржмржВ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржоржзрзНржпрзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржПржиржХрзНрж░рж┐ржкрзНржЯ ржХрж░рзБржи ржпрж╛рждрзЗ ржЯрзЛржХрзЗржиржЧрзБрж▓рж┐ ржЖржЯржХрж╛ржирзЛ ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛ ржкрж╛ржпрж╝ред  
- **Role-Based Access Control (RBAC) ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░рзБржи**: рж╢рзБржзрзБ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржорж╛ржгрзАржХрзГржд ржХрж┐ржирж╛ рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░ржмрзЗржи ржирж╛; рждрж╛рж░рж╛ ржХрзА ржХрж░рждрзЗ ржЕржирзБржорзЛржжрж┐ржд рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржиред Entra ID-рждрзЗ рж░рзЛрж▓ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рждрзЗ ржкрж╛рж░рзЗржи ржПржмржВ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕рзЗржЧрзБрж▓рзЛ ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред  
- **ржоржирж┐ржЯрж░ ржПржмржВ ржЕржбрж┐ржЯ ржХрж░рзБржи**: рж╕ржм ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржЗржнрзЗржирзНржЯ рж▓ржЧ ржХрж░рзБржи ржпрж╛рждрзЗ рж╕ржирзНржжрзЗрж╣ржЬржиржХ ржХрж╛рж░рзНржпржХрж▓рж╛ржк рж╢ржирж╛ржХрзНржд ржУ ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛ ржЬрж╛ржирж╛ржирзЛ ржпрж╛ржпрж╝ред  
- **рж░рзЗржЯ рж▓рж┐ржорж┐ржЯрж┐ржВ ржПржмржВ ржерзНрж░ржЯрж▓рж┐ржВ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рзБржи**: Microsoft Graph ржПржмржВ ржЕржирзНржпрж╛ржирзНржп API-рждрзЗ ржЕржкржмрзНржпржмрж╣рж╛рж░ рж░рзЛржзрзЗ рж░рзЗржЯ рж▓рж┐ржорж┐ржЯрж┐ржВ ржерж╛ржХрзЗред MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржПржХрзНрж╕ржкрзЛржирзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржмрзНржпрж╛ржХржЕржл ржПржмржВ рж░рж┐ржЯрзНрж░рж╛ржЗ рж▓ржЬрж┐ржХ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░рзБржи ржпрж╛рждрзЗ HTTP 429 (Too Many Requests) рж░рзЗрж╕ржкржирзНрж╕ рж╕рзБржирзНржжрж░ржнрж╛ржмрзЗ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рж╛ ржпрж╛ржпрж╝ред ржкрзНрж░рж╛ржпрж╝ржЗ ржмрзНржпржмрж╣рзГржд ржбрзЗржЯрж╛ ржХрзНржпрж╛рж╢рж┐ржВ ржХрж░рж╛рж░ ржХржерж╛ ржнрж╛ржмрзБржи ржпрж╛рждрзЗ API ржХрж▓ ржХржорж╛ржирзЛ ржпрж╛ржпрж╝ред  
- **ржЯрзЛржХрзЗржи рж╕рзБрж░ржХрзНрж╖рж┐рждржнрж╛ржмрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи**: Access token ржПржмржВ refresh token ржирж┐рж░рж╛ржкржжрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржиред рж▓рзЛржХрж╛рж▓ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ рж╕рж┐ржХрж┐ржЙрж░ рж╕рзНржЯрзЛрж░рзЗржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред рж╕рж╛рж░рзНржнрж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп ржПржиржХрзНрж░рж┐ржкрзНржЯрзЗржб рж╕рзНржЯрзЛрж░рзЗржЬ ржмрж╛ Azure Key Vault-ржПрж░ ржорждрзЛ рж╕рж┐ржХрж┐ржЙрж░ ржХрзА ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ рж╕рж╛рж░рзНржнрж┐рж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржХржерж╛ ржнрж╛ржмрзБржиред  
- **ржЯрзЛржХрзЗржи ржорзЗржпрж╝рж╛ржж ржЙрждрзНрждрзАрж░рзНржг рж╣рзНржпрж╛ржирзНржбрзЗрж▓рж┐ржВ**: Access token-ржПрж░ ржПржХржЯрж┐ рж╕рзАржорж┐ржд ржорзЗржпрж╝рж╛ржж ржерж╛ржХрзЗред Refresh token ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЯрзЛржХрзЗржи рж░рж┐ржлрзНрж░рзЗрж╢ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░рзБржи ржпрж╛рждрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзБржирж░рж╛ржпрж╝ ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржЫрж╛ржбрж╝рж╛ржЗ рж╕рзЗржмрж╛ ржЕржмрзНржпрж╛рж╣ржд рж░рж╛ржЦрждрзЗ ржкрж╛рж░рзЗред  
- **Azure API Management ржмрзНржпржмрж╣рж╛рж░ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рзБржи**: MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕рж░рж╛рж╕рж░рж┐ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░рж▓рзЗ рж╕рзВржХрзНрж╖рзНржо ржирж┐ржпрж╝ржирзНрждрзНрж░ржг ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝, рждржмрзЗ Azure API Management-ржПрж░ ржорждрзЛ API ржЧрзЗржЯржУржпрж╝рзЗ ржЕржирзЗржХ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрж┐рж╖ржпрж╝ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗ, ржпрзЗржоржи ржкрзНрж░ржорж╛ржгрзАржХрж░ржг, ржЕржирзБржорзЛржжржи, рж░рзЗржЯ рж▓рж┐ржорж┐ржЯрж┐ржВ ржПржмржВ ржоржирж┐ржЯрж░рж┐ржВред ржПржЧрзБрж▓рзЛ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржПржмржВ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржоржзрзНржпрзЗ ржПржХржЯрж┐ ржХрзЗржирзНржжрзНрж░рзАржпрж╝ ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╕рзНрждрж░ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред MCP-ржПрж░ рж╕рж╛ржерзЗ API ржЧрзЗржЯржУржпрж╝рзЗ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЬрж╛ржирждрзЗ ржЖржорж╛ржжрзЗрж░ [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) ржжрзЗржЦрзБржиред  


## Key Takeaways

- ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЦрж╛ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржпрж╛рждрзЗ ржЖржкржирж╛рж░ ржбрзЗржЯрж╛ ржПржмржВ ржЯрзБрж▓рж╕ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржерж╛ржХрзЗред  
- Microsoft Entra ID ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржПржмржВ рж╕рзНржХрзЗрж▓рзЗржмрж▓ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржУ ржЕржирзБржорзЛржжржи рж╕ржорж╛ржзрж╛ржи ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред  
- рж▓рзЛржХрж╛рж▓ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп **public client** ржПржмржВ рж░рж┐ржорзЛржЯ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп **confidential client** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред  
- ржУржпрж╝рзЗржм ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп **Authorization Code Flow** рж╕ржмржЪрзЗржпрж╝рзЗ ржирж┐рж░рж╛ржкржж ржмрж┐ржХрж▓рзНржкред  


## Exercise

1. ржЖржкржирж┐ ржпрзЗ MCP рж╕рж╛рж░рзНржнрж╛рж░ рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи рждрж╛ ржЪрж┐ржирзНрждрж╛ ржХрж░рзБржиред ржПржЯрж┐ ржХрж┐ рж▓рзЛржХрж╛рж▓ рж╕рж╛рж░рзНржнрж╛рж░ рж╣ржмрзЗ ржирж╛ржХрж┐ рж░рж┐ржорзЛржЯ рж╕рж╛рж░рзНржнрж╛рж░?  
2. ржЖржкржирж╛рж░ ржЙрждрзНрждрж░рзЗрж░ ржнрж┐рждрзНрждрж┐рждрзЗ, ржЖржкржирж┐ public ржирж╛ржХрж┐ confidential client ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?  
3. Microsoft Graph-ржПрж░ ржмрж┐рж░рзБржжрзНржзрзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЛржи ржЕржирзБржорждрж┐ ржЪрж╛ржЗржмрзЗ?  


## Hands-on Exercises

### Exercise 1: Entra ID-рждрзЗ ржПржХржЯрж┐ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржирж┐ржмржирзНржзржи ржХрж░рзБржи  
Microsoft Entra ржкрзЛрж░рзНржЯрж╛рж▓рзЗ ржпрж╛ржиред  
ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржирждрзБржи ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржирж┐ржмржирзНржзржи ржХрж░рзБржиред  
Application (client) ID ржПржмржВ Directory (tenant) ID ржирзЛржЯ ржХрж░рзБржиред  

### Exercise 2: рж▓рзЛржХрж╛рж▓ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рзБржи (Public Client)  
- ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржЬржирзНржп MSAL (Microsoft Authentication Library) ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рж╛рж░ ржХрзЛржб ржЙржжрж╛рж╣рж░ржг ржЕржирзБрж╕рж░ржг ржХрж░рзБржиред  
- Microsoft Graph ржерзЗржХрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрж┐ржмрж░ржг ржЖржирж╛рж░ MCP ржЯрзБрж▓ ржХрж▓ ржХрж░рзЗ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░ржмрж╛рж╣ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржиред  

### Exercise 3: рж░рж┐ржорзЛржЯ MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рзБржи (Confidential Client)  
- Entra ID-рждрзЗ ржПржХржЯрж┐ confidential client ржирж┐ржмржирзНржзржи ржХрж░рзБржи ржПржмржВ ржПржХржЯрж┐ client secret рждрзИрж░рж┐ ржХрж░рзБржиред  
- ржЖржкржирж╛рж░ Express.js MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ Authorization Code Flow ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржиред  
- рж╕рзБрж░ржХрзНрж╖рж┐ржд ржПржирзНржбржкржпрж╝рзЗржирзНржЯржЧрзБрж▓рзЛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи ржПржмржВ ржЯрзЛржХрзЗржи-ржнрж┐рждрзНрждрж┐ржХ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред  

### Exercise 4: Security Best Practices ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржи  
- ржЖржкржирж╛рж░ рж▓рзЛржХрж╛рж▓ ржмрж╛ рж░рж┐ржорзЛржЯ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп HTTPS рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржиред  
- рж╕рж╛рж░рзНржнрж╛рж░ рж▓ржЬрж┐ржХрзЗ role-based access control (RBAC) ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░рзБржиред  
- ржЯрзЛржХрзЗржи ржорзЗржпрж╝рж╛ржж ржЙрждрзНрждрзАрж░рзНржг рж╣рзНржпрж╛ржирзНржбрзЗрж▓рж┐ржВ ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржЯрзЛржХрзЗржи рж╕ржВрж░ржХрзНрж╖ржг ржпрзЛржЧ ржХрж░рзБржиред  


## Resources

1. **MSAL Overview Documentation**  
   Microsoft Authentication Library (MSAL) ржХрзАржнрж╛ржмрзЗ ржмрж┐ржнрж┐ржирзНржи ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржорзЗ ржирж┐рж░рж╛ржкржж ржЯрзЛржХрзЗржи ржЕрж░рзНржЬржи рж╕ржХрзНрж╖ржо ржХрж░рзЗ рждрж╛ рж╢рж┐ржЦрзБржи:  
   [MSAL Overview on Microsoft Learn](https://learn.microsoft.com/en-gb/entra/msal/overview)  

2. **Azure-Samples/mcp-auth-servers GitHub Repository**  
   MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░ржмрж╛рж╣рзЗрж░ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ ржЗржоржкрзНрж▓рж┐ржорзЗржирзНржЯрзЗрж╢ржи:  
   [Azure-Samples/mcp-auth-servers on GitHub](https://github.com/Azure-Samples/mcp-auth-servers)  

3. **Managed Identities for Azure Resources Overview**  
   рж╕рж┐ржХрзНрж░рзЗржЯ ржЫрж╛ржбрж╝рж╛ржЗ рж╕рж┐рж╕рзНржЯрзЗржо ржмрж╛ ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЙржкрж╛ржпрж╝:  
   [Managed Identities Overview on Microsoft Learn](https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/)  

4. **Azure API Management: Your Auth Gateway for MCP Servers**  
   MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЬржирзНржп APIM ржХрзЗ ржПржХржЯрж┐ ржирж┐рж░рж╛ржкржж OAuth2 ржЧрзЗржЯржУржпрж╝рзЗ рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд:  
   [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)  

5. **Microsoft Graph Permissions Reference**  
   Microsoft Graph-ржПрж░ ржЬржирзНржп ржбрзЗрж▓рж┐ржЧрзЗржЯрзЗржб ржПржмржВ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЕржирзБржорждрж┐рж░ ржмрж┐рж╕рзНрждрзГржд рждрж╛рж▓рж┐ржХрж╛:  
   [Microsoft Graph Permissions Reference](https://learn.microsoft.com/zh-tw/graph/permissions-reference)  


## Learning Outcomes  
ржПржЗ ржЕржВрж╢ рж╕ржорзНржкржирзНржи ржХрж░рж╛рж░ ржкрж░ ржЖржкржирж┐ рж╕ржХрзНрж╖ржо рж╣ржмрзЗржи:  

- MCP рж╕рж╛рж░рзНржнрж╛рж░ ржПржмржВ AI ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛрж░ ржЬржирзНржп ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржЧрзБрж░рзБрждрзНржм ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░рждрзЗред  
- рж▓рзЛржХрж╛рж▓ ржПржмржВ рж░рж┐ржорзЛржЯ MCP рж╕рж╛рж░рзНржнрж╛рж░ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рж░ ржЬржирзНржп Entra ID ржкрзНрж░ржорж╛ржгрзАржХрж░ржг рж╕рзЗржЯржЖржк ржУ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗред  
- ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯ ржЕржирзБржпрж╛ржпрж╝рзА рж╕ржарж┐ржХ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржЯрж╛ржЗржк (public ржмрж╛ confidential) ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рждрзЗред  
- ржирж┐рж░рж╛ржкржж ржХрзЛржбрж┐ржВ ржЕржирзБрж╢рзАрж▓ржи ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░рждрзЗ, ржпрж╛рж░ ржоржзрзНржпрзЗ ржЯрзЛржХрзЗржи рж╕ржВрж░ржХрзНрж╖ржг ржПржмржВ рж░рзЛрж▓-ржнрж┐рждрзНрждрж┐ржХ ржЕржирзБржорзЛржжржи ржЕржирзНрждрж░рзНржнрзБржХрзНрждред  
- ржЖржкржирж╛рж░ MCP рж╕рж╛рж░рзНржнрж╛рж░ ржПржмржВ ржПрж░ ржЯрзБрж▓рж╕ржХрзЗ ржЕржиржирзБржорзЛржжрж┐ржд ржкрзНрж░ржмрзЗрж╢ ржерзЗржХрзЗ ржЖрждрзНржоржмрж┐рж╢рзНржмрж╛рж╕рзЗрж░ рж╕рж╛ржерзЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЦрждрзЗред  


## What's next  

- [5.13 Model Context Protocol (MCP) Integration with Azure AI Foundry](../mcp-foundry-agent-integration/README.md)

**ржЕрж╕рзНржмрзАржХрзГрждрж┐**:  
ржПржЗ ржиржерж┐ржЯрж┐ AI ржЕржирзБржмрж╛ржж рж╕рзЗржмрж╛ [Co-op Translator](https://github.com/Azure/co-op-translator) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕржирзВржжрж┐ржд рж╣ржпрж╝рзЗржЫрзЗред ржЖржорж░рж╛ ржпржерж╛рж╕рж╛ржзрзНржп рж╕ржарж┐ржХрждрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж┐, рждржмрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЕржирзБржмрж╛ржжрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛ ржЕрж╕ржЩрзНржЧрждрж┐ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржорзВрж▓ ржиржерж┐ржЯрж┐ рждрж╛рж░ ржирж┐ржЬрж╕рзНржм ржнрж╛рж╖рж╛ржпрж╝ржЗ ржХрж░рзНрждрзГрждрзНржмржкрзВрж░рзНржг ржЙрзОрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрж┐ржмрзЗржЪрж┐ржд рж╣ржУржпрж╝рж╛ ржЙржЪрж┐рждред ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рждржерзНржпрзЗрж░ ржЬржирзНржп ржкрзЗрж╢рж╛ржжрж╛рж░ ржорж╛ржиржм ржЕржирзБржмрж╛ржж ржЧрзНрж░рж╣ржг ржХрж░рж╛рж░ ржкрж░рж╛ржорж░рзНрж╢ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝ред ржПржЗ ржЕржирзБржмрж╛ржжрзЗрж░ ржмрзНржпржмрж╣рж╛рж░рзЗ рж╕рзГрж╖рзНржЯ ржХрзЛржирзЛ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ ржмрж╛ ржнрзБрж▓ ржмрзНржпрж╛ржЦрзНржпрж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ ржжрж╛ржпрж╝рзА ржиржЗред