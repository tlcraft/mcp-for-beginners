<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "0abf26a6c4dbe905d5d49ccdc0ccfe92",
  "translation_date": "2025-06-26T16:24:27+00:00",
  "source_file": "05-AdvancedTopics/mcp-security-entra/README.md",
  "language_code": "mr"
}
-->
# AI рд╡рд░реНрдХрдлреНрд▓реЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ: Model Context Protocol рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг

## рдкрд░рд┐рдЪрдп  
рддреБрдордЪреНрдпрд╛ Model Context Protocol (MCP) рд╕рд░реНрд╡реНрд╣рд░рдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд░рдгреЗ рдореНрд╣рдгрдЬреЗ рддреБрдордЪреНрдпрд╛ рдШрд░рд╛рдЪреНрдпрд╛ рдореБрдЦреНрдп рджрд░рд╡рд╛рдЬрд╛рд▓рд╛ рд▓реЙрдХ рд▓рд╛рд╡рд▓реНрдпрд╛рд╕рд╛рд░рдЦреЗ рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдЖрд╣реЗ. рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдЙрдШрдбрд╛ рдареЗрд╡рдгреЗ рдореНрд╣рдгрдЬреЗ рддреБрдордЪреНрдпрд╛ рд╕рд╛рдзрдирд╛рдВрдирд╛ рдЖрдгрд┐ рдбреЗрдЯрд╛рд▓рд╛ рдЕрдирдзрд┐рдХреГрдд рдкреНрд░рд╡реЗрд╢рд╛рд╕рд╛рдареА рдЦреБрд▓рдВ рд╕реЛрдбрдгреЗ, рдЬреНрдпрд╛рдореБрд│реЗ рд╕реБрд░рдХреНрд╖рд╛ рднрдВрдЧ рд╣реЛрдК рд╢рдХрддрд╛рдд. Microsoft Entra ID рдПрдХ рдордЬрдмреВрдд рдХреНрд▓рд╛рдКрдб-рдЖрдзрд╛рд░рд┐рдд рдУрд│рдЦ рдЖрдгрд┐ рдкреНрд░рд╡реЗрд╢ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ, рдЬреНрдпрд╛рдореБрд│реЗ рдлрдХреНрдд рдЕрдзрд┐рдХреГрдд рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЖрдгрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд╢реА рд╕рдВрд╡рд╛рдж рд╕рд╛рдзреВ рд╢рдХрддрд╛рдд. рдпрд╛ рд╡рд┐рднрд╛рдЧрд╛рдд, рддреБрдореНрд╣реА Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд╛рдкрд░реВрди рддреБрдордЪреНрдпрд╛ AI рд╡рд░реНрдХрдлреНрд▓реЛрдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд╕реЗ рдХрд░рд╛рдпрдЪреЗ рд╣реЗ рд╢рд┐рдХрд╛рд▓.

## рд╢рд┐рдХрдгреНрдпрд╛рдЪреА рдЙрджреНрджрд┐рд╖реНрдЯреЗ  
рдпрд╛ рд╡рд┐рднрд╛рдЧрд╛рдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА, рддреБрдореНрд╣реА рд╕рдХреНрд╖рдо рдЕрд╕рд╛рд▓:

- MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреНрдпрд╛рдЪреЗ рдорд╣рддреНрддреНрд╡ рд╕рдордЬреВрди рдШреЗрдгреЗ.
- Microsoft Entra ID рдЖрдгрд┐ OAuth 2.0 рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рдЪреНрдпрд╛ рдореВрд▓рднреВрдд рдЧреЛрд╖реНрдЯреА рд╕рдордЬрд╛рд╡реВрди рд╕рд╛рдВрдЧрдгреЗ.
- рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдгрд┐ рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯрдордзреАрд▓ рдлрд░рдХ рдУрд│рдЦрдгреЗ.
- рд╕реНрдерд╛рдирд┐рдХ (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ) рдЖрдгрд┐ рджреВрд░рд╕реНрде (рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ) MCP рд╕рд░реНрд╡реНрд╣рд░ рдкрд░рд┐рд╕реНрдерд┐рддреАрдВрдордзреНрдпреЗ Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдВрдорд▓рд╛рдд рдЖрдгрдгреЗ.
- AI рд╡рд░реНрдХрдлреНрд▓реЛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддрд╛рдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА рд▓рд╛рдЧреВ рдХрд░рдгреЗ.

## рд╕реБрд░рдХреНрд╖рд╛ рдЖрдгрд┐ MCP  

рдЬрд╕реЗ рддреБрдореНрд╣реА рддреБрдордЪреНрдпрд╛ рдШрд░рд╛рдЪрд╛ рдореБрдЦреНрдп рджрд░рд╡рд╛рдЬрд╛ рдЙрдШрдбрд╛ рдареЗрд╡рдгрд╛рд░ рдирд╛рд╣реА, рддрд╕рдВрдЪ рддреБрдореНрд╣реА рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдХреЛрдгрд╛рд▓рд╛рд╣реА рдкреНрд░рд╡реЗрд╢рд╛рд╕рд╛рдареА рдЦреБрд▓рд╛ рдареЗрд╡реВ рдирдпреЗ. рддреБрдордЪреНрдпрд╛ AI рд╡рд░реНрдХрдлреНрд▓реЛрдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд░рдгреЗ рдореНрд╣рдгрдЬреЗ рдордЬрдмреВрдд, рд╡рд┐рд╢реНрд╡рд╛рд╕рд╛рд░реНрд╣ рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рддрдпрд╛рд░ рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдд, рддреБрдореНрд╣рд╛рд▓рд╛ Microsoft Entra ID рд╡рд╛рдкрд░реВрди рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд╕реЗ рдХрд░рд╛рдпрдЪреЗ рд╣реЗ рд╢рд┐рдХрд╡рд▓реЗ рдЬрд╛рдИрд▓, рдЬреНрдпрд╛рдореБрд│реЗ рдлрдХреНрдд рдЕрдзрд┐рдХреГрдд рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЖрдгрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рддреБрдордЪреНрдпрд╛ рд╕рд╛рдзрдирд╛рдВрд╢реА рдЖрдгрд┐ рдбреЗрдЯрд╛рд╢реА рд╕рдВрд╡рд╛рдж рд╕рд╛рдзреВ рд╢рдХрддреАрд▓.

## MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛ рдорд╣рддреНрддреНрд╡рд╛рдЪреА рдЖрд╣реЗ  

рдХрд▓реНрдкрдирд╛ рдХрд░рд╛ рдХреА рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд╡рд░ рдПрдХ рд╕рд╛рдзрди рдЖрд╣реЗ рдЬреЗ рдИрдореЗрд▓ рдкрд╛рдард╡реВ рд╢рдХрддреЗ рдХрд┐рдВрд╡рд╛ рдЧреНрд░рд╛рд╣рдХ рдбреЗрдЯрд╛рдмреЗрд╕рдордзреНрдпреЗ рдкреНрд░рд╡реЗрд╢ рдХрд░реВ рд╢рдХрддреЗ. рдЬрд░ рд╕рд░реНрд╡реНрд╣рд░ рдЕрдирд╕реБрд░рдХреНрд╖рд┐рдд рдЕрд╕реЗрд▓ рддрд░ рдХреЛрдгрд╛рд▓рд╛рд╣реА рддреЗ рд╕рд╛рдзрди рд╡рд╛рдкрд░рддрд╛ рдпреЗрдИрд▓, рдЬреНрдпрд╛рдореБрд│реЗ рдЕрдирдзрд┐рдХреГрдд рдбреЗрдЯрд╛ рдкреНрд░рд╡реЗрд╢, рд╕реНрдкреЕрдо рдХрд┐рдВрд╡рд╛ рдЗрддрд░ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХреНрд░рд┐рдпрд╛рдХрд▓рд╛рдк рд╣реЛрдК рд╢рдХрддрд╛рдд.

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдВрдорд▓рд╛рдд рдЖрдгрд▓реНрдпрд╛рдиреЗ, рддреБрдореНрд╣реА рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдирдВрддреАрдЪреА рдЦрд╛рддреНрд░реА рдХрд░рддрд╛ рдХреА рддреА рд╡реИрдз рдЖрд╣реЗ, рдЖрдгрд┐ рд╡рд┐рдирдВрддреА рдХрд░рдгрд╛рд░рд╛ рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдХрд┐рдВрд╡рд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛрдг рдЖрд╣реЗ рд╣реЗ рдкрдбрддрд╛рд│рддрд╛ рдпреЗрддреЗ. рд╣реЗ рддреБрдордЪреНрдпрд╛ AI рд╡рд░реНрдХрдлреНрд▓реЛрдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд░рдгреНрдпрд╛рдЪрд╛ рдкрд╣рд┐рд▓рд╛ рдЖрдгрд┐ рд╕рд░реНрд╡рд╛рдд рдорд╣рддреНрддреНрд╡рд╛рдЪрд╛ рдЯрдкреНрдкрд╛ рдЖрд╣реЗ.

## Microsoft Entra ID рдкрд░рд┐рдЪрдп  

[**Microsoft Entra ID**](https://adoption.microsoft.com/microsoft-security/entra/) рд╣реА рдХреНрд▓рд╛рдКрдб-рдЖрдзрд╛рд░рд┐рдд рдУрд│рдЦ рдЖрдгрд┐ рдкреНрд░рд╡реЗрд╢ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд╕реЗрд╡рд╛ рдЖрд╣реЗ. рдпрд╛рд▓рд╛ рддреБрдордЪреНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА рдПрдХ рд╕рд╛рд░реНрд╡рддреНрд░рд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ рд░рдХреНрд╖рдХ рд╕рдордЬрд╛. рд╣реЗ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдВрдЪреНрдпрд╛ рдУрд│рдЦреАрдЪреА рдкрдбрддрд╛рд│рдгреА (рдкреНрд░рдорд╛рдгреАрдХрд░рдг) рдЖрдгрд┐ рддреНрдпрд╛рдВрдирд╛ рдХрд╛рдп рдХрд░рдгреНрдпрд╛рдЪреА рдкрд░рд╡рд╛рдирдЧреА рдЖрд╣реЗ рд╣реЗ рдард░рд╡рд┐рдгреНрдпрд╛рдЪрд╛ (рдЕрдзрд┐рдХреГрддрддрд╛) рдЧреБрдВрддрд╛рдЧреБрдВрддреАрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпреЗрд▓рд╛ рд╣рд╛рддрд╛рд│рддреЗ.

Entra ID рд╡рд╛рдкрд░реВрди рддреБрдореНрд╣реА:

- рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдВрд╕рд╛рдареА рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдЗрди-рдЗрди рд╕рдХреНрд╖рдо рдХрд░реВ рд╢рдХрддрд╛.
- API рдЖрдгрд┐ рд╕реЗрд╡рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░реВ рд╢рдХрддрд╛.
- рдкреНрд░рд╡реЗрд╢ рдзреЛрд░рдгреЗ рдПрдХрд╛ рдХреЗрдВрджреНрд░реАрдХреГрдд рдард┐рдХрд╛рдгрд╛рд╣реВрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░реВ рд╢рдХрддрд╛.

MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА, Entra ID рдПрдХ рдордЬрдмреВрдд рдЖрдгрд┐ рд╡рд┐рд╢реНрд╡рд╛рд╕рд╛рд░реНрд╣ рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ рдЬреНрдпрд╛рджреНрд╡рд╛рд░реЗ рдХреЛрдг рддреБрдордЪреНрдпрд╛ рд╕рд░реНрд╡реНрд╣рд░рдЪреНрдпрд╛ рдХреНрд╖рдорддрд╛рдВрдкрд░реНрдпрдВрдд рдкреЛрд╣реЛрдЪреВ рд╢рдХрддреЛ рд╣реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рдпреЗрддреЗ.

---

## Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реЗ рд╕рдордЬреВрди рдШреЗрдгреЗ  

Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рд╕рд╛рдареА **OAuth 2.0** рд╕рд╛рд░рдЦреНрдпрд╛ рдЦреБрд▓реНрдпрд╛ рдорд╛рдирдХрд╛рдВрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░рддреЗ. рддрдкрд╢реАрд▓ рдереЛрдбреЗ рдЧреБрдВрддрд╛рдЧреБрдВрддреАрдЪреЗ рдЕрд╕реВ рд╢рдХрддрд╛рдд, рдкрдг рдореВрд│ рд╕рдВрдХрд▓реНрдкрдирд╛ рд╕реЛрдкреА рдЖрд╣реЗ рдЖрдгрд┐ рдПрдХрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рджреНрд╡рд╛рд░реЗ рд╕рдордЬреВрди рдШреЗрддрд╛ рдпреЗрддреЗ.

### OAuth 2.0 рдЪреА рд╕рд╛рдзреА рдУрд│рдЦ: Valet Key (рд╡рд╛рд╣рди рдареЗрд╡рдгрд╛рд▒реНрдпрд╛ рдХрд│реАрдЪрд╛)  

OAuth 2.0 рдореНрд╣рдгрдЬреЗ рддреБрдордЪреНрдпрд╛ рдХрд╛рд░рд╕рд╛рдареА рд╡рд╛рд╣рди рдареЗрд╡рдгрд╛рд▒реНрдпрд╛ рд╕реЗрд╡реЗрдкреНрд░рдорд╛рдгреЗ рд╕рдордЬрд╛. рдЬреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рд░реЗрд╕реНрдЯреЙрд░рдВрдЯрд▓рд╛ рдкреЛрд╣реЛрдЪрддрд╛, рддреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рддреБрдордЪреА рдореБрдЦреНрдп рдХрд│реА рд╡рд╛рд╣рди рдареЗрд╡рдгрд╛рд▒реНрдпрд╛рд▓рд╛ рджреЗрдд рдирд╛рд╣реА. рддреНрдпрд╛рдРрд╡рдЬреА, рддреБрдореНрд╣реА рдПрдХ **valet key** рджреЗрддрд╛ рдЬреНрдпрд╛рд▓рд╛ рдорд░реНрдпрд╛рджрд┐рдд рдкрд░рд╡рд╛рдирдЧреНрдпрд╛ рдЕрд╕рддрд╛рддтАФрддреА рдХрд╛рд░ рд╕реБрд░реВ рдХрд░реВ рд╢рдХрддреЗ рдЖрдгрд┐ рджрд░рд╡рд╛рдЬреЗ рд▓реЙрдХ рдХрд░реВ рд╢рдХрддреЗ, рдкрдг рдЯреНрд░рдВрдХ рдХрд┐рдВрд╡рд╛ рдЧреНрд▓реЛрд╡реНрд╣ рдХрдореНрдкрд╛рд░реНрдЯрдореЗрдВрдЯ рдЙрдШрдбреВ рд╢рдХрдд рдирд╛рд╣реА.

рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдд:

- **рддреБрдореНрд╣реА** рдореНрд╣рдгрдЬреЗ **рд╡рд╛рдкрд░рдХрд░реНрддрд╛**.
- **рддреБрдордЪреА рдХрд╛рд░** рдореНрд╣рдгрдЬреЗ **MCP рд╕рд░реНрд╡реНрд╣рд░** рдЬреНрдпрд╛рдд рдорд╣рддреНрддреНрд╡рд╛рдЪреА рд╕рд╛рдзрдиреЗ рдЖрдгрд┐ рдбреЗрдЯрд╛ рдЖрд╣реЗ.
- **Valet** рдореНрд╣рдгрдЬреЗ **Microsoft Entra ID**.
- **Parking Attendant** рдореНрд╣рдгрдЬреЗ **MCP рдХреНрд▓рд╛рдпрдВрдЯ** (рдЬреЛ рд╕рд░реНрд╡реНрд╣рд░рд╢реА рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпрддреНрди рдХрд░рддреЛ).
- **Valet Key** рдореНрд╣рдгрдЬреЗ **Access Token**.

Access token рд╣рд╛ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдордЬрдХреВрд░рд╛рдЪрд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЖрд╣реЗ рдЬреЛ MCP рдХреНрд▓рд╛рдпрдВрдЯрд▓рд╛ Entra ID рдХрдбреВрди рд╕рд╛рдЗрди-рдЗрди рдирдВрддрд░ рдорд┐рд│рддреЛ. рдХреНрд▓рд╛рдпрдВрдЯ рдирдВрддрд░ рд╣рд╛ рдЯреЛрдХрди рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдирдВрддреАрд╕рд╣ MCP рд╕рд░реНрд╡реНрд╣рд░рд▓рд╛ рд╕рд╛рджрд░ рдХрд░рддреЛ. рд╕рд░реНрд╡реНрд╣рд░ рд╣рд╛ рдЯреЛрдХрди рдкрдбрддрд╛рд│реВрди рдЦрд╛рддреНрд░реА рдХрд░рддреЛ рдХреА рд╡рд┐рдирдВрддреА рд╡реИрдз рдЖрд╣реЗ рдЖрдгрд┐ рдХреНрд▓рд╛рдпрдВрдЯрдХрдбреЗ рдЖрд╡рд╢реНрдпрдХ рдкрд░рд╡рд╛рдирдЧреНрдпрд╛ рдЖрд╣реЗрдд, рддреЗрд╣реА рддреБрдордЪреЗ рдЦрд░реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ (рдЬрд╕реЗ рдХреА рдкрд╛рд╕рд╡рд░реНрдб) рд╣рд╛рддрд╛рд│рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рди рдкрдбрддрд╛.

### рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣  

рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд рдХрд╢реА рдЪрд╛рд▓рддреЗ рддреЗ рдкреБрдвреАрд▓рдкреНрд░рдорд╛рдгреЗ:

```mermaid
sequenceDiagram
    actor User as ЁЯСд User
    participant Client as ЁЯЦея╕П MCP Client
    participant Entra as ЁЯФР Microsoft Entra ID
    participant Server as ЁЯФз MCP Server

    Client->>+User: Please sign in to continue.
    User->>+Entra: Enters credentials (username/password).
    Entra-->>Client: Here is your access token.
    User-->>-Client: (Returns to the application)

    Client->>+Server: I need to use a tool. Here is my access token.
    Server->>+Entra: Is this access token valid?
    Entra-->>-Server: Yes, it is.
    Server-->>-Client: Token is valid. Here is the result of the tool.
```

### Microsoft Authentication Library (MSAL) рдЪреА рдУрд│рдЦ  

рдХреЛрдбрдордзреНрдпреЗ рдкреБрдвреЗ рдЬрд╛рдКрди, рдПрдХ рдорд╣рддреНрддреНрд╡рд╛рдЪрд╛ рдШрдЯрдХ рдореНрд╣рдгрдЬреЗ **Microsoft Authentication Library (MSAL)**.

MSAL рд╣реА Microsoft рдХрдбреВрди рд╡рд┐рдХрд╕рд┐рдд рдХреЗрд▓реЗрд▓реА рдПрдХ рд▓рд╛рдпрдмреНрд░рд░реА рдЖрд╣реЗ рдЬреА рд╡рд┐рдХрд╕рдХрд╛рдВрд╕рд╛рдареА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣рд╛рддрд╛рд│рдгреЗ рдЦреВрдк рд╕реЛрдкреЗ рдХрд░рддреЗ. рддреБрдореНрд╣рд╛рд▓рд╛ рд╕реБрд░рдХреНрд╖рд╛ рдЯреЛрдХрдиреНрд╕ рд╣рд╛рддрд╛рд│рдгреНрдпрд╛рд╕рд╛рдареА, рд╕рд╛рдЗрди-рдЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЖрдгрд┐ рд╕рддреНрд░ рд░реАрдлреНрд░реЗрд╢ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╕рдВрдкреВрд░реНрдг рдЧреБрдВрддрд╛рдЧреБрдВрддреАрдЪрд╛ рдХреЛрдб рд▓рд┐рд╣рд╛рд╡рд╛ рд▓рд╛рдЧрдд рдирд╛рд╣реА, MSAL рд╣реЗ рдХрд╛рдо рд╕рд╣рдЬ рдХрд░рддреЗ.

MSAL рд╡рд╛рдкрд░рдгреЗ рдпрд╛рд╕рд╛рдареА рд╢рд┐рдлрд╛рд░рд╕реАрдп рдЖрд╣реЗ рдХрд╛рд░рдг:

- **рд╣реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдЖрд╣реЗ:** рдЙрджреНрдпреЛрдЧрдорд╛рдирдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреАрдВрдЪреЗ рдкрд╛рд▓рди рдХрд░рддреЗ, рдЬреНрдпрд╛рдореБрд│реЗ рддреБрдордЪреНрдпрд╛ рдХреЛрдбрдордзреАрд▓ рдзреЛрдХреЗ рдХрдореА рд╣реЛрддрд╛рдд.
- **рд╣реЗ рд╡рд┐рдХрд╛рд╕ рд╕реБрд▓рдн рдХрд░рддреЗ:** OAuth 2.0 рдЖрдгрд┐ OpenID Connect рдкреНрд░реЛрдЯреЛрдХреЙрд▓рдЪреА рдЧреБрдВрддрд╛рдЧреБрдВрдд рд▓рдкрд╡реВрди рдареЗрдКрди, рдлрдХреНрдд рдХрд╛рд╣реА рдУрд│реАрдВрдЪреНрдпрд╛ рдХреЛрдбрдиреЗ рдордЬрдмреВрдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЬреЛрдбрддрд╛ рдпреЗрддреЗ.
- **рд╣реЗ рдХрд╛рдпрдорд╕реНрд╡рд░реВрдкреА рдЕрдкрдбреЗрдЯ рд╣реЛрддреЗ:** Microsoft рдирд┐рдпрдорд┐рддрдкрдгреЗ MSAL рдЪреЗ рдЕрдкрдбреЗрдЯреНрд╕ рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдзрд╛рд░рдгрд╛рдВрд╕рд╛рдареА рджреЗрдЦрднрд╛рд▓ рдХрд░рддреЗ.

MSAL рдЕрдиреЗрдХ рднрд╛рд╖рд╛ рдЖрдгрд┐ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдлреНрд░реЗрдорд╡рд░реНрдХрд╕рд╛рдареА рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ, рдЬрд╕реЗ рдХреА .NET, JavaScript/TypeScript, Python, Java, Go, рдЖрдгрд┐ рдореЛрдмрд╛рдЗрд▓ рдкреНрд▓реЕрдЯрдлреЙрд░реНрдореНрд╕ iOS рдЖрдгрд┐ Android. рдпрд╛рдЪрд╛ рдЕрд░реНрде рддреБрдореНрд╣реА рддреБрдордЪреНрдпрд╛ рддрдВрддреНрд░рдЬреНрдЮрд╛рди рд╕реНрдЯреЕрдХрд╡рд░ рдПрдХрд╕рд╛рд░рдЦреНрдпрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрджреНрдзрддреА рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛.

MSAL рдмрджреНрджрд▓ рдЕрдзрд┐рдХ рдЬрд╛рдгреВрди рдШреЗрдгреНрдпрд╛рд╕рд╛рдареА, рддреБрдореНрд╣реА рдЕрдзрд┐рдХреГрдд [MSAL overview documentation](https://learn.microsoft.com/entra/identity-platform/msal-overview) рдкрд╛рд╣реВ рд╢рдХрддрд╛.

---

## Entra ID рд╡рд╛рдкрд░реВрди рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ: рдЯрдкреНрдкреНрдпрд╛рдЯрдкреНрдкреНрдпрд╛рдиреЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди  

рдЖрддрд╛, рд╕реНрдерд╛рдирд┐рдХ MCP рд╕рд░реНрд╡реНрд╣рд░ (рдЬреЛ `stdio`) using Entra ID. This example uses a **public client**, which is suitable for applications running on a user's machine, like a desktop app or a local development server.

### Scenario 1: Securing a Local MCP Server (with a Public Client)

In this scenario, we'll look at an MCP server that runs locally, communicates over `stdio`, and uses Entra ID to authenticate the user before allowing access to its tools. The server will have a single tool that fetches the user's profile information from the Microsoft Graph API.

#### 1. Setting Up the Application in Entra ID

Before writing any code, you need to register your application in Microsoft Entra ID. This tells Entra ID about your application and grants it permission to use the authentication service.

1. Navigate to the **[Microsoft Entra portal](https://entra.microsoft.com/)**.
2. Go to **App registrations** and click **New registration**.
3. Give your application a name (e.g., "My Local MCP Server").
4. For **Supported account types**, select **Accounts in this organizational directory only**.
5. You can leave the **Redirect URI** blank for this example.
6. Click **Register**.

Once registered, take note of the **Application (client) ID** and **Directory (tenant) ID**. You'll need these in your code.

#### 2. The Code: A Breakdown

Let's look at the key parts of the code that handle authentication. The full code for this example is available in the [Entra ID - Local - WAM](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-local-wam) folder of the [mcp-auth-servers GitHub repository](https://github.com/Azure-Samples/mcp-auth-servers).

**`AuthenticationService.cs`**

This class is responsible for handling the interaction with Entra ID.

- **`CreateAsync`**: This method initializes the `PublicClientApplication` from the MSAL (Microsoft Authentication Library). It's configured with your application's `clientId` and `tenantId`.
- **`WithBroker`**: This enables the use of a broker (like the Windows Web Account Manager), which provides a more secure and seamless single sign-on experience.
- **`AcquireTokenAsync` рд╡рд╛рдкрд░реВрди рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрддреЛ) рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреНрдпрд╛рдЪрд╛ рдорд╛рд░реНрдЧ рдкрд╛рд╣реВрдпрд╛: рд╣реА рдореБрдЦреНрдп рдкрджреНрдзрдд рдЖрд╣реЗ. рд╣реЗ рдкреНрд░рдердо рд╢рд╛рдВрддрдкрдгреЗ рдЯреЛрдХрди рдорд┐рд│рд╡рдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпрддреНрди рдХрд░рддреЗ (рдЬрд░ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рдЖрдзреАрдЪ рд╡реИрдз рд╕рддреНрд░ рдЕрд╕реЗрд▓ рддрд░ рддреНрдпрд╛рд▓рд╛ рдкреБрдиреНрд╣рд╛ рд╕рд╛рдЗрди-рдЗрди рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧрдгрд╛рд░ рдирд╛рд╣реА). рдЬрд░ рд╢рд╛рдВрддрдкрдгреЗ рдЯреЛрдХрди рдорд┐рд│рд╡рддрд╛ рдЖрд▓реЗ рдирд╛рд╣реА, рддрд░ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рд╕рдВрд╡рд╛рджрд╛рддреНрдордХ рд╕рд╛рдЗрди-рдЗрдирд╕рд╛рдареА рд╡рд┐рдЪрд╛рд░рдгрд╛ рдХреЗрд▓реА рдЬрд╛рддреЗ.

```csharp
// Simplified for clarity
public static async Task<AuthenticationService> CreateAsync(ILogger<AuthenticationService> logger)
{
    var msalClient = PublicClientApplicationBuilder
        .Create(_clientId) // Your Application (client) ID
        .WithAuthority(AadAuthorityAudience.AzureAdMyOrg)
        .WithTenantId(_tenantId) // Your Directory (tenant) ID
        .WithBroker(new BrokerOptions(BrokerOptions.OperatingSystems.Windows))
        .Build();

    // ... cache registration ...

    return new AuthenticationService(logger, msalClient);
}

public async Task<string> AcquireTokenAsync()
{
    try
    {
        // Try silent authentication first
        var accounts = await _msalClient.GetAccountsAsync();
        var account = accounts.FirstOrDefault();

        AuthenticationResult? result = null;

        if (account != null)
        {
            result = await _msalClient.AcquireTokenSilent(_scopes, account).ExecuteAsync();
        }
        else
        {
            // If no account, or silent fails, go interactive
            result = await _msalClient.AcquireTokenInteractive(_scopes).ExecuteAsync();
        }

        return result.AccessToken;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "An error occurred while acquiring the token.");
        throw; // Optionally rethrow the exception for higher-level handling
    }
}
```

**`Program.cs`**

This is where the MCP server is set up and the authentication service is integrated.

- **`AddSingleton<AuthenticationService>`**: This registers the `AuthenticationService` with the dependency injection container, so it can be used by other parts of the application (like our tool).
- **`GetUserDetailsFromGraph` tool**: This tool requires an instance of `AuthenticationService`. Before it does anything, it calls `authService.AcquireTokenAsync()` рд╡рд╛рдкрд░реВрди рд╡реИрдз access token рдорд┐рд│рд╡рддреЛ. рдЬрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпрд╢рд╕реНрд╡реА рдЭрд╛рд▓реЗ, рддрд░ рд╣рд╛ рдЯреЛрдХрди рд╡рд╛рдкрд░реВрди Microsoft Graph API рдХреЙрд▓ рдХрд░рддреЛ рдЖрдгрд┐ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреЗ рддрдкрд╢реАрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЛ.

```csharp
// Simplified for clarity
[McpServerTool(Name = "GetUserDetailsFromGraph")]
public static async Task<string> GetUserDetailsFromGraph(
    AuthenticationService authService)
{
    try
    {
        // This will trigger the authentication flow
        var accessToken = await authService.AcquireTokenAsync();

        // Use the token to create a GraphServiceClient
        var graphClient = new GraphServiceClient(
            new BaseBearerTokenAuthenticationProvider(new TokenProvider(authService)));

        var user = await graphClient.Me.GetAsync();

        return System.Text.Json.JsonSerializer.Serialize(user);
    }
    catch (Exception ex)
    {
        return $"Error: {ex.Message}";
    }
}
```

#### рей. рд╕рд░реНрд╡ рдХрд╛рд╣реА рдПрдХрддреНрд░ рдХрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ  

1. рдЬреЗрд╡реНрд╣рд╛ MCP рдХреНрд▓рд╛рдпрдВрдЯ `GetUserDetailsFromGraph` tool, the tool first calls `AcquireTokenAsync`.
2. `AcquireTokenAsync` triggers the MSAL library to check for a valid token.
3. If no token is found, MSAL, through the broker, will prompt the user to sign in with their Entra ID account.
4. Once the user signs in, Entra ID issues an access token.
5. The tool receives the token and uses it to make a secure call to the Microsoft Graph API.
6. The user's details are returned to the MCP client.

This process ensures that only authenticated users can use the tool, effectively securing your local MCP server.

### Scenario 2: Securing a Remote MCP Server (with a Confidential Client)

When your MCP server is running on a remote machine (like a cloud server) and communicates over a protocol like HTTP Streaming, the security requirements are different. In this case, you should use a **confidential client** and the **Authorization Code Flow**. This is a more secure method because the application's secrets are never exposed to the browser.

This example uses a TypeScript-based MCP server that uses Express.js to handle HTTP requests.

#### 1. Setting Up the Application in Entra ID

The setup in Entra ID is similar to the public client, but with one key difference: you need to create a **client secret**.

1. Navigate to the **[Microsoft Entra portal](https://entra.microsoft.com/)**.
2. In your app registration, go to the **Certificates & secrets** tab.
3. Click **New client secret**, give it a description, and click **Add**.
4. **Important:** Copy the secret value immediately. You will not be able to see it again.
5. You also need to configure a **Redirect URI**. Go to the **Authentication** tab, click **Add a platform**, select **Web**, and enter the redirect URI for your application (e.g., `http://localhost:3001/auth/callback`).

> **тЪая╕П Important Security Note:** For production applications, Microsoft strongly recommends using **secretless authentication** methods such as **Managed Identity** or **Workload Identity Federation** instead of client secrets. Client secrets pose security risks as they can be exposed or compromised. Managed identities provide a more secure approach by eliminating the need to store credentials in your code or configuration.
>
> For more information about managed identities and how to implement them, see the [Managed identities for Azure resources overview](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview).

#### 2. The Code: A Breakdown

This example uses a session-based approach. When the user authenticates, the server stores the access token and refresh token in a session and gives the user a session token. This session token is then used for subsequent requests. The full code for this example is available in the [Entra ID - Confidential client](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-cca-session) folder of the [mcp-auth-servers GitHub repository](https://github.com/Azure-Samples/mcp-auth-servers).

**`Server.ts`**

This file sets up the Express server and the MCP transport layer.

- **`requireBearerAuth`**: This is middleware that protects the `/sse` and `/message` endpoints. It checks for a valid bearer token in the `Authorization` header of the request.
- **`EntraIdServerAuthProvider`**: This is a custom class that implements the `McpServerAuthorizationProvider` interface. It's responsible for handling the OAuth 2.0 flow.
- **`/auth/callback` рдпрд╛ endpoint рд▓рд╛ рдХреЙрд▓ рдХрд░рддреЛ: рд╣рд╛ endpoint рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреНрдпрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рдирдВрддрд░ Entra ID рдХрдбреВрди redirect рд╣рдБрдбрд▓ рдХрд░рддреЛ. рддреЛ authorization code рдмрджрд▓реВрди access token рдЖрдгрд┐ refresh token рдорд┐рд│рд╡рддреЛ.

```typescript
// Simplified for clarity
const app = express();
const { server } = createServer();
const provider = new EntraIdServerAuthProvider();

// Protect the SSE endpoint
app.get("/sse", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... connect to the transport ...
});

// Protect the message endpoint
app.post("/message", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... handle the message ...
});

// Handle the OAuth 2.0 callback
app.get("/auth/callback", (req, res) => {
  provider.handleCallback(req.query.code, req.query.state)
    .then(result => {
      // ... handle success or failure ...
    });
});
```

**`Tools.ts`**

This file defines the tools that the MCP server provides. The `getUserDetails` рд╕рд╛рдзрди рдорд╛рдЧреАрд▓ рдЙрджрд╛рд╣рд░рдгрд╛рд╕рд╛рд░рдЦреЗ рдЖрд╣реЗ, рдкрдг рддреЗ рд╕рддреНрд░рд╛рддреВрди access token рдорд┐рд│рд╡рддреЗ.

```typescript
// Simplified for clarity
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name } = request.params;
  const context = request.params?.context as { token?: string } | undefined;
  const sessionToken = context?.token;

  if (name === ToolName.GET_USER_DETAILS) {
    if (!sessionToken) {
      throw new AuthenticationError("Authentication token is missing or invalid. Ensure the token is provided in the request context.");
    }

    // Get the Entra ID token from the session store
    const tokenData = tokenStore.getToken(sessionToken);
    const entraIdToken = tokenData.accessToken;

    const graphClient = Client.init({
      authProvider: (done) => {
        done(null, entraIdToken);
      }
    });

    const user = await graphClient.api('/me').get();

    // ... return user details ...
  }
});
```

**`auth/EntraIdServerAuthProvider.ts`**

This class handles the logic for:

- Redirecting the user to the Entra ID sign-in page.
- Exchanging the authorization code for an access token.
- Storing the tokens in the `tokenStore`.
- Refreshing the access token when it expires.

#### 3. How It All Works Together

1. When a user first tries to connect to the MCP server, the `requireBearerAuth` middleware will see that they don't have a valid session and will redirect them to the Entra ID sign-in page.
2. The user signs in with their Entra ID account.
3. Entra ID redirects the user back to the `/auth/callback` endpoint with an authorization code.
4. The server exchanges the code for an access token and a refresh token, stores them, and creates a session token which is sent to the client.
5. The client can now use this session token in the `Authorization` header for all future requests to the MCP server.
6. When the `getUserDetails` рд╕рд╛рдзрди рдХреЙрд▓ рдХреЗрд▓реНрдпрд╛рд╡рд░, рддреЗ рд╕рддреНрд░ рдЯреЛрдХрди рд╡рд╛рдкрд░реВрди Entra ID access token рд╢реЛрдзрддреЗ рдЖрдгрд┐ рдирдВрддрд░ рддреЗ рд╡рд╛рдкрд░реВрди Microsoft Graph API рдХреЙрд▓ рдХрд░рддреЗ.

рд╣рд╛ рдкреНрд░рд╡рд╛рд╣ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ рдкреНрд░рд╡рд╛рд╣рд╛рдкреЗрдХреНрд╖рд╛ рдЕрдзрд┐рдХ рдЧреБрдВрддрд╛рдЧреБрдВрддреАрдЪрд╛ рдЖрд╣реЗ, рдкрдг рдЗрдВрдЯрд░рдиреЗрдЯрд╡рд░реАрд▓ endpoints рд╕рд╛рдареА рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдХрд╛рд░рдг рджреВрд░рд╕реНрде MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯрд╡рд░ рдЙрдкрд▓рдмреНрдз рдЕрд╕рддрд╛рдд, рддреНрдпрд╛рдВрдирд╛ рдЕрдирдзрд┐рдХреГрдд рдкреНрд░рд╡реЗрд╢ рдЖрдгрд┐ рд╕рдВрднрд╛рд╡реНрдп рд╣рд▓реНрд▓реНрдпрд╛рдВрдкрд╛рд╕реВрди рд╕рдВрд░рдХреНрд╖рдгрд╛рд╕рд╛рдареА рдЕрдзрд┐рдХ рдордЬрдмреВрдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпрд╛рдВрдЪреА рдЧрд░рдЬ рдЕрд╕рддреЗ.

## рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА  

- **рдиреЗрд╣рдореА HTTPS рд╡рд╛рдкрд░рд╛**: рдХреНрд▓рд╛рдпрдВрдЯ рдЖрдгрд┐ рд╕рд░реНрд╡реНрд╣рд░рдордзреАрд▓ рд╕рдВрд╡рд╛рдж рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди рдЯреЛрдХрдиреНрд╕ рдЪреЛрд░реА рд╣реЛрдК рдирдпреЗрдд.
- **Role-Based Access Control (RBAC) рд▓рд╛рдЧреВ рдХрд░рд╛**: рдлрдХреНрдд рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЭрд╛рд▓рд╛ рдЖрд╣реЗ рдХрд╛ рддреЗ рддрдкрд╛рд╕реВ рдирдХрд╛; рддреНрдпрд╛рд▓рд╛ рдХрд╛рдп рдЕрдзрд┐рдХрд╛рд░ рдЖрд╣реЗрдд рддреЗ рддрдкрд╛рд╕рд╛. рддреБрдореНрд╣реА Entra ID рдордзреНрдпреЗ рднреВрдорд┐рдХрд╛ рдард░рд╡реВ рд╢рдХрддрд╛ рдЖрдгрд┐ рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ рддреНрдпрд╛ рддрдкрд╛рд╕реВ рд╢рдХрддрд╛.
- **рдирд┐рдпрдВрддреНрд░рдг рдЖрдгрд┐ рдСрдбрд┐рдЯрд┐рдВрдЧ рдХрд░рд╛**: рд╕рд░реНрд╡ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдШрдЯрдирд╛рдВрдЪреЗ рд▓реЙрдЧ рдареЗрд╡рд╛ рдЬреЗрдгреЗрдХрд░реВрди рд╕рдВрд╢рдпрд╛рд╕реНрдкрдж рдХреНрд░рд┐рдпрд╛рдХрд▓рд╛рдк рдУрд│рдЦрддрд╛ рдпреЗрддреАрд▓.
- **рд░реЗрдЯ рд▓рд┐рдорд┐рдЯрд┐рдВрдЧ рдЖрдгрд┐ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ рд╣рд╛рддрд╛рд│рд╛**: Microsoft Graph рдЖрдгрд┐ рдЗрддрд░ API рд░реЗрдЯ рд▓рд┐рдорд┐рдЯрд┐рдВрдЧ рд╡рд╛рдкрд░рддрд╛рдд рдЬреНрдпрд╛рдореБрд│реЗ рдЧреИрд░рд╡рд╛рдкрд░ рдЯрд╛рд│рддрд╛ рдпреЗрддреЛ. MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ рдПрдХреНрд╕реНрдкреЛрдиреЗрдВрд╢рд┐рдпрд▓ рдмреЕрдХрдСрдл рдЖрдгрд┐ рдкреБрдирд░реНрдкреНрд░рдпрддреНрди рд▓реЙрдЬрд┐рдХ рд╡рд╛рдкрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди HTTP 429 (рдЕрддреНрдпрдзрд┐рдХ рд╡рд┐рдирдВрддреНрдпрд╛) рдкреНрд░рддрд┐рд╕рд╛рдж рдпреЛрдЧреНрдпрд░рд┐рддреНрдпрд╛ рд╣рд╛рддрд╛рд│рддрд╛ рдпреЗрддреАрд▓. рд╡рд╛рд░рдВрд╡рд╛рд░ рд╡рд╛рдкрд░рд▓реНрдпрд╛ рдЬрд╛рдгрд╛рд▒реНрдпрд╛ рдбреЗрдЯрд╛рдЪреЗ рдХреЕрд╢рд┐рдВрдЧ рдХрд░реВрди API рдХреЙрд▓ рдХрдореА рдХрд░рд╛.
- **рдЯреЛрдХрди рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдард╡рдгреВрдХ**: Access tokens рдЖрдгрд┐ refresh tokens рд╕реБрд░рдХреНрд╖рд┐рддрдкрдгреЗ рд╕рд╛рдард╡рд╛. рд╕реНрдерд╛рдирд┐рдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА, рд╕рд┐рд╕реНрдЯрдордЪреА рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдард╡рдг рдпрдВрддреНрд░рдгрд╛ рд╡рд╛рдкрд░рд╛. рд╕рд░реНрд╡реНрд╣рд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╕рд╛рдард╡рдгреВрдХ рдХрд┐рдВрд╡рд╛ Azure Key Vault рд╕рд╛рд░рдЦреНрдпрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд╕реЗрд╡рд╛ рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рд╛.
- **рдЯреЛрдХрди рдХрд╛рд▓рдмрд╛рд╣реНрдпрддрд╛ рд╣рд╛рддрд╛рд│рдгреА**: Access tokens рдЪреА рд╡реИрдзрддрд╛ рдорд░реНрдпрд╛рджрд┐рдд рдЕрд╕рддреЗ. Refresh tokens рд╡рд╛рдкрд░реВрди рдЖрдкреЛрдЖрдк рдЯреЛрдХрди рд░реАрдлреНрд░реЗрд╢ рдХрд░рдгреНрдпрд╛рдЪреА рд╕реЛрдп рдХрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рдкреБрдиреНрд╣рд╛ рд╕рд╛рдЗрди-рдЗрди рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧрдгрд╛рд░ рдирд╛рд╣реА.
- **Azure API Management рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рд╛**: MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ рдереЗрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдВрдорд▓рд╛рдд рдЖрдгрд▓реНрдпрд╛рдиреЗ рддреБрдореНрд╣рд╛рд▓рд╛ рд╕реВрдХреНрд╖реНрдо рдирд┐рдпрдВрддреНрд░рдг рдорд┐рд│рддреЗ, рдкрдг API рдЧреЗрдЯрд╡реЗ рдЬрд╕реЗ Azure API Management рдЕрдиреЗрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЪрд┐рдВрддрд╛ рд╕реНрд╡рдпрдВрдЪрд▓рд┐рддрдкрдгреЗ рд╣рд╛рддрд╛рд│реВ рд╢рдХрддрд╛рдд, рдЬрд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рдЕрдзрд┐рдХреГрддрддрд╛, рд░реЗрдЯ рд▓рд┐рдорд┐рдЯрд┐рдВрдЧ рдЖрдгрд┐ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ. рд╣реЗ рддреБрдордЪреНрдпрд╛ рдХреНрд▓рд╛рдпрдВрдЯреНрд╕ рдЖрдгрд┐ MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреАрд▓ рдордзреНрдпрд╡рд░реНрддреА рд╕реБрд░рдХреНрд╖рд╛ рдерд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛рдд. MCP рд╕рд╛рдареА API рдЧреЗрдЯрд╡реЗ рд╡рд╛рдкрд░рдгреНрдпрд╛рдмрд╛рдмрдд рдЕрдзрд┐рдХ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА рдЖрдордЪрд╛ [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) рдкрд╣рд╛.

## рдореБрдЦреНрдп рдореБрджреНрджреЗ  

- рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ рдореНрд╣рдгрдЬреЗ рддреБрдордЪрд╛ рдбреЗрдЯрд╛ рдЖрдгрд┐ рд╕рд╛рдзрдиреЗ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ.
- Microsoft Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЖрдгрд┐ рдЕрдзрд┐рдХреГрддрддреЗрд╕рд╛рдареА рдПрдХ рдордЬрдмреВрдд рдЖрдгрд┐ рд╕реНрдХреЗрд▓реЗрдмрд▓ рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ.
- рд╕реНрдерд╛рдирд┐рдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ** рдЖрдгрд┐ рджреВрд░рд╕реНрде рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА **рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ** рд╡рд╛рдкрд░рд╛.
- рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА **Authorization Code Flow** рд╣рд╛ рд╕рд░реНрд╡рд╛рдд рд╕реБрд░рдХреНрд╖рд┐рдд рдкрд░реНрдпрд╛рдп рдЖрд╣реЗ.

## рд╡реНрдпрд╛рдпрд╛рдо  

1. рддреБрдореНрд╣реА рдХрджрд╛рдЪрд┐рдд рдХреЛрдгрддрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рддрдпрд╛рд░ рдХрд░рд╛рд▓ рдпрд╛рдЪрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рд╛. рддреЛ рд╕реНрдерд╛рдирд┐рдХ рд╕рд░реНрд╡реНрд╣рд░ рдЕрд╕реЗрд▓ рдХреА рджреВрд░рд╕реНрде рд╕рд░реНрд╡реНрд╣рд░?
2. рддреБрдордЪреНрдпрд╛ рдЙрддреНрддрд░рд╛рдиреБрд╕рд╛рд░, рддреБрдореНрд╣реА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ рд╡рд╛рдкрд░рд╛рд▓ рдХреА рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ?
3. Microsoft Graph рд╡рд┐рд░реЛрдзрд╛рдд рдХреНрд░рд┐рдпрд╛ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд▓рд╛ рдХреЛрдгрддреА рдкрд░рд╡рд╛рдирдЧреА рдорд╛рдЧрд╛рдпрдЪреА?

## рдкреНрд░рддреНрдпрдХреНрд╖ рд╡реНрдпрд╛рдпрд╛рдо  

### рд╡реНрдпрд╛рдпрд╛рдо 1: Entra ID рдордзреНрдпреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдиреЛрдВрджрдгреА рдХрд░рд╛  
Microsoft Entra рдкреЛрд░реНрдЯрд▓рд╡рд░ рдЬрд╛.  
рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рдирд╡реАрди рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдиреЛрдВрджрдгреА рдХрд░рд╛.  
Application (client) ID рдЖрдгрд┐ Directory (tenant) ID рдиреЛрдВрдж рдХрд░рд╛.

### рд╡реНрдпрд╛рдпрд╛рдо 2: рд╕реНрдерд╛рдирд┐рдХ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рд╛ (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ)  
- рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рд╕рд╛рдареА MSAL (Microsoft Authentication Library) рд╕рдорд╛рдХрд▓рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЛрдб рдЙрджрд╛рд╣рд░рдгрд╛рдЪреЗ рдкрд╛рд▓рди рдХрд░рд╛.  
- Microsoft Graph рдордзреВрди рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪрд╛ рддрдкрд╢реАрд▓ рдорд┐рд│рд╡рдгрд╛рд░реЗ MCP рдЯреВрд▓ рдХреЙрд▓ рдХрд░реВрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рддрдкрд╛рд╕рд╛.

### рд╡реНрдпрд╛рдпрд╛рдо 3: рджреВрд░рд╕реНрде MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рд╛ (рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ)  
- Entra ID рдордзреНрдпреЗ рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ рдиреЛрдВрджрдгреА рдХрд░рд╛ рдЖрдгрд┐ рдХреНрд▓рд╛рдпрдВрдЯ рд╕реАрдХреНрд░реЗрдЯ рддрдпрд╛рд░ рдХрд░рд╛.  
- рддреБрдордЪрд╛ Express.js MCP рд╕рд░реНрд╡реНрд╣рд░ Authorization Code Flow рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛.  
- рд╕рдВрд░рдХреНрд╖рд┐рдд endpoints рдЪреА рдЪрд╛рдЪрдгреА рдХрд░рд╛ рдЖрдгрд┐ рдЯреЛрдХрди-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рд╡реЗрд╢рд╛рдЪреА рдкреБрд╖реНрдЯреА рдХрд░рд╛.

### рд╡реНрдпрд╛рдпрд╛рдо 4: рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА рд▓рд╛рдЧреВ рдХрд░рд╛  
- рддреБрдордЪреНрдпрд╛ рд╕реНрдерд╛рдирд┐рдХ рдХрд┐рдВрд╡рд╛ рджреВрд░рд╕реНрде рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА HTTPS рд╕рдХреНрд╖рдо рдХрд░рд╛.  
- рд╕рд░реНрд╡реНрд╣рд░ рд▓реЙрдЬрд┐рдХрдордзреНрдпреЗ рднреВрдорд┐рдХрд╛-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рд╡реЗрд╢ рдирд┐рдпрдВрддреНрд░рдг (RBAC) рд▓рд╛рдЧреВ рдХрд░рд╛.  
- рдЯреЛрдХрди рдХрд╛рд▓рдмрд╛рд╣реНрдпрддрд╛ рд╣рд╛рддрд╛рд│рдгреА рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рдЯреЛрдХрди рд╕рд╛рдард╡рдгреВрдХ рдЬреЛрдбрд╛.

## рд╕рдВрд╕рд╛рдзрдиреЗ  

1. **MSAL рдУрд╡реНрд╣рд░рд╡реНрд╣реНрдпреВ рдбреЙрдХреНрдпреБрдореЗрдВрдЯреЗрд╢рди**  
   Microsoft Authentication Library (MSAL) рдХрд╢реА рд╕реБрд░рдХреНрд╖рд┐рдд рдЯреЛрдХрди рдорд┐рд│рд╡рдгреНрдпрд╛рдЪреА рд╕реЛрдп рдХрд░рддреЗ рд╣реЗ рдЬрд╛рдгреВрди рдШреНрдпрд╛:  
   [MSAL Overview on Microsoft Learn](https://learn.microsoft.com/en-gb/entra/msal/overview)

2. **Azure-Samples/mcp-auth-servers GitHub рд░рд┐рдкреЙрдЭрд┐рдЯрд░реА**  
   рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рджрд╛рдЦрд╡рдгрд╛рд▒реНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдЪреНрдпрд╛ рд╕рдВрджрд░реНрднрд╛рд╕рд╛рдареА:  
   [Azure-Samples/mcp-auth-servers on GitHub](https://github.com/Azure-Samples/mcp-auth-servers)

3. **Azure Resources рд╕рд╛рдареА Managed Identities рдкрд░рд┐рдЪрдп**  
   рд╕рд┐рд╕реНрдЯрдо рдХрд┐рдВрд╡рд╛ рд╡рд╛рдкрд░рдХрд░реНрддрд╛-рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдУрд│рдЦреА рд╡рд╛рдкрд░реВрди рдЧреБрдкрд┐рддреЗ рдХрд╢реА рдЯрд╛рд│рд╛рдпрдЪреА рддреЗ рд╕рдордЬреВрди рдШреНрдпрд╛:  
   [Managed Identities Overview on Microsoft Learn](https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/)

4. **Azure API Management: MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рддреБрдордЪрд╛ Auth Gateway**  
   MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА OAuth2 рдЧреЗрдЯрд╡реЗ рдореНрд╣рдгреВрди APIM рдХрд╕реЗ рд╡рд╛рдкрд░рд╛рдпрдЪреЗ рдпрд╛рдЪреЗ рд╕рдЦреЛрд▓ рд╡рд░реНрдгрди:  
   [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)

5. **Microsoft Graph Permissions рд╕рдВрджрд░реНрдн**  
   Microsoft Graph рд╕рд╛рдареА рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдЖрдгрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдкрд░рд╡рд╛рдирдЧреНрдпрд╛рдВрдЪреА рд╕рд╡рд┐рд╕реНрддрд░ рдпрд╛рджреА:  
   [Microsoft Graph Permissions Reference](https://learn.microsoft.com/zh-tw/graph/permissions-reference)

## рд╢рд┐рдХрдгреНрдпрд╛рдЪреЗ рдкрд░рд┐рдгрд╛рдо  
рд╣рд╛ рд╡рд┐рднрд╛рдЧ рдкреВрд░реНрдг рдХреЗрд▓реНрдпрд╛рд╡рд░, рддреБрдореНрд╣реА:

- MCP рд╕рд░реНрд╡реНрд╣рд░ рдЖрдгрд┐ AI рд╡рд░реНрдХрдлреНрд▓реЛрд╕рд╛рдареА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдЖрд╣реЗ рд╣реЗ рд╕реНрдкрд╖реНрдЯ рдХрд░реВ рд╢рдХрд╛рд▓.  
- рд╕реНрдерд╛рдирд┐рдХ рдЖрдгрд┐ рджреВрд░рд╕реНрде MCP рд╕рд░реНрд╡реНрд╣рд░ рдкрд░рд┐рд╕реНрдерд┐рддреАрд╕рд╛рдареА Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗрдЯрдЕрдк рдЖрдгрд┐ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░реВ рд╢рдХрд╛рд▓.  
- рддреБрдордЪреНрдпрд╛ рд╕рд░реНрд╡реНрд╣рд░рдЪреНрдпрд╛ рддреИрдирд╛рддреАрд╡рд░ рдЖрдзрд╛рд░рд┐рдд рдпреЛрдЧреНрдп рдХреНрд▓рд╛рдпрдВрдЯ рдкреНрд░рдХрд╛рд░ (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХрд┐рдВрд╡рд╛ рдЧреЛрдкрдиреАрдп) рдирд┐рд╡

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣рд╛ рджрд╕реНрддрдРрд╡рдЬ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЕрдиреБрд╡рд╛рджрд┐рдд рдХреЗрд▓рд╛ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрди рдХрд░рддреЛ, рдкрд░рдВрддреБ рдХреГрдкрдпрд╛ рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрд╛рдВрдордзреНрдпреЗ рдЪреБрдХрд╛ рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪрд╛ рдЕрднрд╛рд╡ рдЕрд╕реВ рд╢рдХрддреЛ. рдореВрд│ рджрд╕реНрддрдРрд╡рдЬ рддреНрдпрд╛рдЪреНрдпрд╛ рд╕реНрдерд╛рдирд┐рдХ рднрд╛рд╖реЗрдд рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдкрд╛рд╣рд┐рдЬреЗ. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрдХрд░рд┐рддрд╛ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рдЕрдиреБрд╡рд╛рджрд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рдЕрдиреБрд╡рд╛рджрд╛рдЪреНрдпрд╛ рд╡рд╛рдкрд░рд╛рдореБрд│реЗ рдЙрджреНрднрд╡рд▓реЗрд▓реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬреБрддреА рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд▓рд╛рднрд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рдирд╛рд╣реА.