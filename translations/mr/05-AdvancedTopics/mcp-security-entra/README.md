<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "6e562d7e5a77c8982da4aa8f762ad1d8",
  "translation_date": "2025-07-14T02:56:33+00:00",
  "source_file": "05-AdvancedTopics/mcp-security-entra/README.md",
  "language_code": "mr"
}
-->
# AI рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ: Model Context Protocol рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг

## рдкрд░рд┐рдЪрдп  
рддреБрдордЪреНрдпрд╛ Model Context Protocol (MCP) рд╕рд░реНрд╡реНрд╣рд░рдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд░рдгреЗ рдореНрд╣рдгрдЬреЗ рддреБрдордЪреНрдпрд╛ рдШрд░рд╛рдЪрд╛ рдореБрдЦреНрдп рджрд░рд╡рд╛рдЬрд╛ рд▓реЙрдХ рдХрд░рдгреЗ рдЗрддрдХреЗрдЪ рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдЖрд╣реЗ. рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдЙрдШрдбрд╛ рдареЗрд╡рдгреЗ рдореНрд╣рдгрдЬреЗ рддреБрдордЪреА рд╕рд╛рдзрдиреЗ рдЖрдгрд┐ рдбреЗрдЯрд╛ рдЕрдирдзрд┐рдХреГрдд рдкреНрд░рд╡реЗрд╢рд╛рд╕рд╛рдареА рдЙрдШрдбреЗ рдареЗрд╡рдгреЗ, рдЬреНрдпрд╛рдореБрд│реЗ рд╕реБрд░рдХреНрд╖рд╛ рднрдВрдЧ рд╣реЛрдК рд╢рдХрддреЛ. Microsoft Entra ID рдПрдХ рдордЬрдмреВрдд рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рдУрд│рдЦ рдЖрдгрд┐ рдкреНрд░рд╡реЗрд╢ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ, рдЬреНрдпрд╛рдореБрд│реЗ рдлрдХреНрдд рдЕрдзрд┐рдХреГрдд рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЖрдгрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд╢реА рд╕рдВрд╡рд╛рдж рд╕рд╛рдзреВ рд╢рдХрддрд╛рдд. рдпрд╛ рд╡рд┐рднрд╛рдЧрд╛рдд, рддреБрдореНрд╣рд╛рд▓рд╛ Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд╛рдкрд░реВрди рддреБрдордЪреЗ AI рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рдХрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рд╛рдпрдЪреЗ рддреЗ рд╢рд┐рдХрд╡рд▓реЗ рдЬрд╛рдИрд▓.

## рд╢рд┐рдХрдгреНрдпрд╛рдЪреЗ рдЙрджреНрджрд┐рд╖реНрдЯ  
рдпрд╛ рд╡рд┐рднрд╛рдЧрд╛рдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА, рддреБрдореНрд╣реА рдЦрд╛рд▓реАрд▓ рдЧреЛрд╖реНрдЯреА рдХрд░реВ рд╢рдХрд╛рд▓:

- MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреНрдпрд╛рдЪреЗ рдорд╣рддреНрддреНрд╡ рд╕рдордЬреВрди рдШреЗрдгреЗ.
- Microsoft Entra ID рдЖрдгрд┐ OAuth 2.0 рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рдЪреА рдореВрд▓рддрддреНрддреНрд╡реЗ рд╕рдордЬрд╛рд╡реВрди рд╕рд╛рдВрдЧрдгреЗ.
- рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдгрд┐ рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯрдордзреАрд▓ рдлрд░рдХ рдУрд│рдЦрдгреЗ.
- рд╕реНрдерд╛рдирд┐рдХ (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ) рдЖрдгрд┐ рд░рд┐рдореЛрдЯ (рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ) MCP рд╕рд░реНрд╡реНрд╣рд░ рдкрд░рд┐рд╕реНрдерд┐рддреАрдВрдордзреНрдпреЗ Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╕реЗ рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛рдпрдЪреЗ рддреЗ рд╢рд┐рдХрдгреЗ.
- AI рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддрд╛рдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА рд▓рд╛рдЧреВ рдХрд░рдгреЗ.

## рд╕реБрд░рдХреНрд╖рд╛ рдЖрдгрд┐ MCP

рдЬрд╕реЗ рддреБрдореНрд╣реА рддреБрдордЪреНрдпрд╛ рдШрд░рд╛рдЪрд╛ рдореБрдЦреНрдп рджрд░рд╡рд╛рдЬрд╛ рдЙрдШрдбрд╛ рдареЗрд╡рдгрд╛рд░ рдирд╛рд╣реА, рддрд╕рдВрдЪ рддреБрдореНрд╣реА рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдХреЛрдгрд╛рд▓рд╛рд╣реА рдкреНрд░рд╡реЗрд╢рд╛рд╕рд╛рдареА рдЙрдШрдбрд╛ рдареЗрд╡реВ рдирдпреЗ. рддреБрдордЪреЗ AI рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рд╕реБрд░рдХреНрд╖рд┐рдд рдареЗрд╡рдгреЗ рдореНрд╣рдгрдЬреЗ рдордЬрдмреВрдд, рд╡рд┐рд╢реНрд╡рд╛рд╕рд╛рд░реНрд╣ рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рддрдпрд╛рд░ рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдд, рддреБрдореНрд╣рд╛рд▓рд╛ Microsoft Entra ID рд╡рд╛рдкрд░реВрди рддреБрдордЪреЗ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреНрдпрд╛рдЪрд╛ рдкрд░рд┐рдЪрдп рджрд┐рд▓рд╛ рдЬрд╛рдИрд▓, рдЬреНрдпрд╛рдореБрд│реЗ рдлрдХреНрдд рдЕрдзрд┐рдХреГрдд рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЖрдгрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рддреБрдордЪреНрдпрд╛ рд╕рд╛рдзрдирд╛рдВрд╢реА рдЖрдгрд┐ рдбреЗрдЯрд╛рд╢реА рд╕рдВрд╡рд╛рдж рд╕рд╛рдзреВ рд╢рдХрддреАрд▓.

## MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛ рдорд╣рддреНрддреНрд╡рд╛рдЪреА рдЖрд╣реЗ

рдХрд▓реНрдкрдирд╛ рдХрд░рд╛ рдХреА рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд╡рд░ рдПрдХ рд╕рд╛рдзрди рдЖрд╣реЗ рдЬреЗ рдИрдореЗрд▓ рдкрд╛рдард╡реВ рд╢рдХрддреЗ рдХрд┐рдВрд╡рд╛ рдЧреНрд░рд╛рд╣рдХ рдбреЗрдЯрд╛рдмреЗрд╕рдордзреНрдпреЗ рдкреНрд░рд╡реЗрд╢ рдХрд░реВ рд╢рдХрддреЗ. рдЬрд░ рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╕реЗрд▓, рддрд░ рдХреЛрдгрд╛рд▓рд╛рд╣реА рддреЗ рд╕рд╛рдзрди рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪреА рд╕рдВрдзреА рдорд┐рд│реЗрд▓, рдЬреНрдпрд╛рдореБрд│реЗ рдЕрдирдзрд┐рдХреГрдд рдбреЗрдЯрд╛ рдкреНрд░рд╡реЗрд╢, рд╕реНрдкреЕрдо рдХрд┐рдВрд╡рд╛ рдЗрддрд░ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХреНрд░рд┐рдпрд╛рдХрд▓рд╛рдк рд╣реЛрдК рд╢рдХрддрд╛рдд.

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдВрдорд▓рд╛рдд рдЖрдгрд▓реНрдпрд╛рдиреЗ, рддреБрдореНрд╣реА рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдирдВрддреАрдЪреА рдкрдбрддрд╛рд│рдгреА рдХрд░рддрд╛, рдЬреНрдпрд╛рдореБрд│реЗ рд╡рд┐рдирдВрддреА рдХрд░рдгрд╛рд▒реНрдпрд╛ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреА рдХрд┐рдВрд╡рд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдЪреА рдУрд│рдЦ рдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрддреЗ. рд╣реЗ рддреБрдордЪреНрдпрд╛ AI рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреНрдпрд╛рдЪрд╛ рдкрд╣рд┐рд▓рд╛ рдЖрдгрд┐ рд╕рд░реНрд╡рд╛рдд рдорд╣рддреНрддреНрд╡рд╛рдЪрд╛ рдЯрдкреНрдкрд╛ рдЖрд╣реЗ.

## Microsoft Entra ID рдкрд░рд┐рдЪрдп

[**Microsoft Entra ID**](https://adoption.microsoft.com/microsoft-security/entra/) рд╣реА рдПрдХ рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рдУрд│рдЦ рдЖрдгрд┐ рдкреНрд░рд╡реЗрд╢ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд╕реЗрд╡рд╛ рдЖрд╣реЗ. рдпрд╛рд▓рд╛ рддреБрдордЪреНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА рдПрдХ рд╕рд╛рд░реНрд╡рддреНрд░рд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ рд░рдХреНрд╖рдХ рд╕рдордЬрд╛. рд╣реЗ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдВрдЪреНрдпрд╛ рдУрд│рдЦреАрдЪреА рдкрдбрддрд╛рд│рдгреА (рдкреНрд░рдорд╛рдгреАрдХрд░рдг) рдЖрдгрд┐ рддреНрдпрд╛рдВрдирд╛ рдХрд╛рдп рдХрд░рдгреНрдпрд╛рдЪреА рдкрд░рд╡рд╛рдирдЧреА рдЖрд╣реЗ рд╣реЗ рдард░рд╡рдгреНрдпрд╛рдЪрд╛ (рдЕрдзрд┐рдХреГрддрддрд╛) рдЧреБрдВрддрд╛рдЧреБрдВрддреАрдЪрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣рд╛рддрд╛рд│рддреЗ.

Entra ID рд╡рд╛рдкрд░реВрди рддреБрдореНрд╣реА:

- рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдВрд╕рд╛рдареА рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдЗрди-рдЗрди рд╕рдХреНрд╖рдо рдХрд░реВ рд╢рдХрддрд╛.
- API рдЖрдгрд┐ рд╕реЗрд╡рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░реВ рд╢рдХрддрд╛.
- рдкреНрд░рд╡реЗрд╢ рдзреЛрд░рдгреЗ рдПрдХрд╛ рдХреЗрдВрджреНрд░реАрдХреГрдд рдард┐рдХрд╛рдгрд╛рд╣реВрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░реВ рд╢рдХрддрд╛.

MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА, Entra ID рдПрдХ рдордЬрдмреВрдд рдЖрдгрд┐ рд╡рд┐рд╢реНрд╡рд╛рд╕рд╛рд░реНрд╣ рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ рдЬреНрдпрд╛рджреНрд╡рд╛рд░реЗ рдХреЛрдг MCP рд╕рд░реНрд╡реНрд╣рд░рдЪреНрдпрд╛ рдХреНрд╖рдорддрд╛рдВрдкрд░реНрдпрдВрдд рдкреНрд░рд╡реЗрд╢ рдХрд░реВ рд╢рдХрддреЛ рд╣реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рдпреЗрддреЗ.

---

## рдЬрд╛рджреВ рд╕рдордЬреВрди рдШреЗрдгреЗ: Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ

Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рд╕рд╛рдареА **OAuth 2.0** рд╕рд╛рд░рдЦреНрдпрд╛ рдЦреБрд▓реЗ рдорд╛рдирдХ рд╡рд╛рдкрд░рддреЗ. рддрдкрд╢реАрд▓ рдЬрдЯрд┐рд▓ рдЕрд╕реВ рд╢рдХрддрд╛рдд, рдкрдг рдореВрд│ рд╕рдВрдХрд▓реНрдкрдирд╛ рд╕реЛрдкреА рдЖрд╣реЗ рдЖрдгрд┐ рдПрдХ рдЙрдкрдорд╛ рд╡рд╛рдкрд░реВрди рд╕рдордЬреВрди рдШреЗрддрд╛ рдпреЗрддреЗ.

### OAuth 2.0 рдЪреА рд╕реМрдореНрдп рдУрд│рдЦ: рд╡реНрд╣реЕрд▓реЗрдЯ рдХреА

OAuth 2.0 рд▓рд╛ рддреБрдордЪреНрдпрд╛ рдХрд╛рд░рд╕рд╛рдареА рд╡реНрд╣реЕрд▓реЗрдЯ рд╕реЗрд╡рд╛ рд╕рдордЬрд╛. рдЬреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рд░реЗрд╕реНрдЯреЙрд░рдВрдЯрд▓рд╛ рдЬрд╛рддрд╛, рддреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рд╡реНрд╣реЕрд▓реЗрдЯрд▓рд╛ рддреБрдордЪреА рдореБрдЦреНрдп рдХреА рджреЗрдд рдирд╛рд╣реА. рддреНрдпрд╛рдРрд╡рдЬреА, рддреБрдореНрд╣реА рдПрдХ **рд╡реНрд╣реЕрд▓реЗрдЯ рдХреА** рджреЗрддрд╛ рдЬреНрдпрд╛рд▓рд╛ рдорд░реНрдпрд╛рджрд┐рдд рдкрд░рд╡рд╛рдирдЧреНрдпрд╛ рдЕрд╕рддрд╛рддтАФрддреА рдХрд╛рд░ рд╕реБрд░реВ рдХрд░реВ рд╢рдХрддреЗ рдЖрдгрд┐ рджрд░рд╡рд╛рдЬреЗ рд▓реЙрдХ рдХрд░реВ рд╢рдХрддреЗ, рдкрдг рдЯреНрд░рдВрдХ рдХрд┐рдВрд╡рд╛ рдЧреНрд▓реЛрд╡реНрд╣ рдХреЙрдореНрдкрд╛рд░реНрдЯрдореЗрдВрдЯ рдЙрдШрдбреВ рд╢рдХрдд рдирд╛рд╣реА.

рдпрд╛ рдЙрдкрдореЗрдд:

- **рддреБрдореНрд╣реА** рдореНрд╣рдгрдЬреЗ **рд╡рд╛рдкрд░рдХрд░реНрддрд╛**.
- **рддреБрдордЪреА рдХрд╛рд░** рдореНрд╣рдгрдЬреЗ **MCP рд╕рд░реНрд╡реНрд╣рд░** рдЬреНрдпрд╛рдд рдореМрд▓реНрдпрд╡рд╛рди рд╕рд╛рдзрдиреЗ рдЖрдгрд┐ рдбреЗрдЯрд╛ рдЖрд╣реЗ.
- **рд╡реНрд╣реЕрд▓реЗрдЯ** рдореНрд╣рдгрдЬреЗ **Microsoft Entra ID**.
- **рдкрд╛рд░реНрдХрд┐рдВрдЧ рдЕрдЯреЗрдВрдбрдВрдЯ** рдореНрд╣рдгрдЬреЗ **MCP рдХреНрд▓рд╛рдпрдВрдЯ** (рдЬреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╕рд░реНрд╡реНрд╣рд░рд╢реА рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрдд рдЖрд╣реЗ).
- **рд╡реНрд╣реЕрд▓реЗрдЯ рдХреА** рдореНрд╣рдгрдЬреЗ **Access Token**.

Access token рд╣рд╛ Entra ID рдХрдбреВрди рд╕рд╛рдЗрди-рдЗрди рдХреЗрд▓реНрдпрд╛рдирдВрддрд░ MCP рдХреНрд▓рд╛рдпрдВрдЯрд▓рд╛ рдорд┐рд│рдгрд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдордЬрдХреВрд░рд╛рдЪрд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЖрд╣реЗ. рдХреНрд▓рд╛рдпрдВрдЯ рд╣рд╛ рдЯреЛрдХрди рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдирдВрддреАрд╕рд╣ MCP рд╕рд░реНрд╡реНрд╣рд░рд▓рд╛ рд╕рд╛рджрд░ рдХрд░рддреЛ. рд╕рд░реНрд╡реНрд╣рд░ рдЯреЛрдХрдирдЪреА рдкрдбрддрд╛рд│рдгреА рдХрд░реВрди рд╡рд┐рдирдВрддреА рд╡реИрдз рдЖрд╣реЗ рдХрд╛ рдЖрдгрд┐ рдХреНрд▓рд╛рдпрдВрдЯрдХрдбреЗ рдЖрд╡рд╢реНрдпрдХ рдкрд░рд╡рд╛рдирдЧреНрдпрд╛ рдЖрд╣реЗрдд рдХрд╛ рд╣реЗ рддрдкрд╛рд╕реВ рд╢рдХрддреЛ, рдЖрдгрд┐ рддреБрдордЪреЗ рдЦрд░реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ (рдЬрд╕реЗ рдХреА рдкрд╛рд╕рд╡рд░реНрдб) рд╣рд╛рддрд╛рд│рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рдирд╛рд╣реА.

### рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣

рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд рдХрд╢реА рдЪрд╛рд▓рддреЗ рддреЗ рдЦрд╛рд▓реАрд▓рдкреНрд░рдорд╛рдгреЗ:

```mermaid
sequenceDiagram
    actor User as ЁЯСд User
    participant Client as ЁЯЦея╕П MCP Client
    participant Entra as ЁЯФР Microsoft Entra ID
    participant Server as ЁЯФз MCP Server

    Client->>+User: Please sign in to continue.
    User->>+Entra: Enters credentials (username/password).
    Entra-->>Client: Here is your access token.
    User-->>-Client: (Returns to the application)

    Client->>+Server: I need to use a tool. Here is my access token.
    Server->>+Entra: Is this access token valid?
    Entra-->>-Server: Yes, it is.
    Server-->>-Client: Token is valid. Here is the result of the tool.
```

### Microsoft Authentication Library (MSAL) рдЪреА рдУрд│рдЦ

рдХреЛрдбрдордзреНрдпреЗ рдЦреЛрд▓рд╡рд░ рдЬрд╛рдгреНрдпрд╛рдкреВрд░реНрд╡реА, рдПрдХ рдорд╣рддреНрддреНрд╡рд╛рдЪрд╛ рдШрдЯрдХ рдУрд│рдЦреВрди рдШреЗрдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ: **Microsoft Authentication Library (MSAL)**.

MSAL рд╣реА Microsoft рджреНрд╡рд╛рд░реЗ рд╡рд┐рдХрд╕рд┐рдд рдХреЗрд▓реЗрд▓реА рд▓рд╛рдпрдмреНрд░рд░реА рдЖрд╣реЗ рдЬреА рд╡рд┐рдХрд╕рдХрд╛рдВрд╕рд╛рдареА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣рд╛рддрд╛рд│рдгреЗ рдЦреВрдк рд╕реЛрдкреЗ рдХрд░рддреЗ. рддреБрдореНрд╣рд╛рд▓рд╛ рд╕реБрд░рдХреНрд╖рд╛ рдЯреЛрдХрди рд╣рд╛рддрд╛рд│рдгреЗ, рд╕рд╛рдЗрди-рдЗрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдгреЗ рдЖрдгрд┐ рд╕рддреНрд░ рд░рд┐рдлреНрд░реЗрд╢ рдХрд░рдгреЗ рдпрд╛рд╕рд╛рдареА рдЬрдЯрд┐рд▓ рдХреЛрдб рд▓рд┐рд╣рд╛рд╡реЗ рд▓рд╛рдЧрдд рдирд╛рд╣реА, MSAL рд╣реЗ рд╕рд░реНрд╡ рдХрд╛рдо рдХрд░рддреЗ.

MSAL рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдЦрд╛рд▓реАрд▓ рдХрд╛рд░рдгрд╛рдВрд╕рд╛рдареА рдХреЗрд▓реА рдЬрд╛рддреЗ:

- **рд╕реБрд░рдХреНрд╖рд┐рдд рдЖрд╣реЗ:** рд╣реЗ рдЙрджреНрдпреЛрдЧрдорд╛рдирдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА рд╡рд╛рдкрд░рддреЗ, рдЬреНрдпрд╛рдореБрд│реЗ рддреБрдордЪреНрдпрд╛ рдХреЛрдбрдордзреАрд▓ рдзреЛрдХреЗ рдХрдореА рд╣реЛрддрд╛рдд.
- **рд╡рд┐рдХрд╛рд╕ рд╕реБрд▓рдн рдХрд░рддреЗ:** OAuth 2.0 рдЖрдгрд┐ OpenID Connect рдкреНрд░реЛрдЯреЛрдХреЙрд▓рдЪреА рдЧреБрдВрддрд╛рдЧреБрдВрдд рд▓рдкрд╡реВрди, рдХрд╛рд╣реА рдУрд│реАрдВрдЪреНрдпрд╛ рдХреЛрдбрдиреЗ рдордЬрдмреВрдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЬреЛрдбрдгреНрдпрд╛рд╕ рдорджрдд рдХрд░рддреЗ.
- **рджреЗрдЦрднрд╛рд▓ рдХреЗрд▓реА рдЬрд╛рддреЗ:** Microsoft MSAL рдирд┐рдпрдорд┐рддрдкрдгреЗ рдЕрджреНрдпрдпрд╛рд╡рдд рдХрд░рддреЗ рдЬреЗрдгреЗрдХрд░реВрди рдирд╡реАрди рд╕реБрд░рдХреНрд╖рд╛ рдзреЛрдХреЗ рдЖрдгрд┐ рдкреНрд▓реЕрдЯрдлреЙрд░реНрдо рдмрджрд▓ рд╣рд╛рддрд╛рд│рд▓реЗ рдЬрд╛рддреАрд▓.

MSAL .NET, JavaScript/TypeScript, Python, Java, Go рдЖрдгрд┐ iOS, Android рд╕рд╛рд░рдЦреНрдпрд╛ рдореЛрдмрд╛рдЗрд▓ рдкреНрд▓реЕрдЯрдлреЙрд░реНрдорд╕рд╛рдареА рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ. рддреНрдпрд╛рдореБрд│реЗ рддреБрдореНрд╣реА рддреБрдордЪреНрдпрд╛ рддрдВрддреНрд░рдЬреНрдЮрд╛рдирд╛рдЪреНрдпрд╛ рд╕рдВрдкреВрд░реНрдг рд╕реНрдЯреЕрдХрдордзреНрдпреЗ рдПрдХрд╕рд╛рд░рдЦреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдирдореБрдиреЗ рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛.

MSAL рдмрджреНрджрд▓ рдЕрдзрд┐рдХ рдЬрд╛рдгреВрди рдШреЗрдгреНрдпрд╛рд╕рд╛рдареА, рдЕрдзрд┐рдХреГрдд [MSAL рдЖрдврд╛рд╡рд╛ рджрд╕реНрддрдРрд╡рдЬ](https://learn.microsoft.com/entra/identity-platform/msal-overview) рдкрд╛рд╣реВ рд╢рдХрддрд╛.

---

## Entra ID рд╡рд╛рдкрд░реВрди рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ: рдЯрдкреНрдкреНрдпрд╛рдЯрдкреНрдкреНрдпрд╛рдиреЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди

рдЖрддрд╛, Entra ID рд╡рд╛рдкрд░реВрди рд╕реНрдерд╛рдирд┐рдХ MCP рд╕рд░реНрд╡реНрд╣рд░ (рдЬреЛ `stdio` рджреНрд╡рд╛рд░реЗ рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрддреЛ) рдХрд╕рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рд╛рдпрдЪрд╛ рддреЗ рдкрд╛рд╣реВрдпрд╛. рд╣рд╛ рдЙрджрд╛рд╣рд░рдг **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯ** рд╡рд╛рдкрд░рддреЛ, рдЬреЛ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреНрдпрд╛ рд╕рдВрдЧрдгрдХрд╛рд╡рд░ рдЪрд╛рд▓рдгрд╛рд▒реНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА рдпреЛрдЧреНрдп рдЖрд╣реЗ, рдЬрд╕реЗ рдХреА рдбреЗрд╕реНрдХрдЯреЙрдк рдЕреЕрдк рдХрд┐рдВрд╡рд╛ рд╕реНрдерд╛рдирд┐рдХ рд╡рд┐рдХрд╛рд╕ рд╕рд░реНрд╡реНрд╣рд░.

### рдкрд░рд┐рд╕реНрдерд┐рддреА 1: рд╕реНрдерд╛рдирд┐рдХ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯрд╕рд╣)

рдпрд╛ рдкрд░рд┐рд╕реНрдерд┐рддреАрдд, рдЖрдкрдг рд╕реНрдерд╛рдирд┐рдХрдкрдгреЗ рдЪрд╛рд▓рдгрд╛рд░рд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдкрд╛рд╣рдгрд╛рд░ рдЖрд╣реЛрдд рдЬреЛ `stdio` рджреНрд╡рд╛рд░реЗ рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрддреЛ рдЖрдгрд┐ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рдкреНрд░рд╡реЗрд╢ рджреЗрдгреНрдпрд╛рдкреВрд░реНрд╡реА Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд╛рдкрд░рддреЛ. рд╕рд░реНрд╡реНрд╣рд░рдХрдбреЗ рдПрдХ рд╕рд╛рдзрди рдЕрд╕реЗрд▓ рдЬреЗ Microsoft Graph API рдХрдбреВрди рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреА рдкреНрд░реЛрдлрд╛рдЗрд▓ рдорд╛рд╣рд┐рддреА рдЖрдгрддреЗ.

#### 1. Entra ID рдордзреНрдпреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╕реЗрдЯрдЕрдк рдХрд░рдгреЗ

рдХреЛрдб рд▓рд┐рд╣рд┐рдгреНрдпрд╛рдкреВрд░реНрд╡реА, рддреБрдореНрд╣рд╛рд▓рд╛ рддреБрдордЪрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ Microsoft Entra ID рдордзреНрдпреЗ рдиреЛрдВрджрдгреА рдХрд░рд╛рд╡рд╛ рд▓рд╛рдЧреЗрд▓. рдпрд╛рдореБрд│реЗ Entra ID рд▓рд╛ рддреБрдордЪреНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдЪреА рдорд╛рд╣рд┐рддреА рдорд┐рд│рддреЗ рдЖрдгрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗрд╡рд╛ рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪреА рдкрд░рд╡рд╛рдирдЧреА рджрд┐рд▓реА рдЬрд╛рддреЗ.

1. **[Microsoft Entra рдкреЛрд░реНрдЯрд▓](https://entra.microsoft.com/)** рд╡рд░ рдЬрд╛.
2. **App registrations** рдордзреНрдпреЗ рдЬрд╛рдКрди **New registration** рдХреНрд▓рд┐рдХ рдХрд░рд╛.
3. рддреБрдордЪреНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рд▓рд╛ рдирд╛рд╡ рджреНрдпрд╛ (рдЙрджрд╛. "My Local MCP Server").
4. **Supported account types** рдордзреНрдпреЗ **Accounts in this organizational directory only** рдирд┐рд╡рдбрд╛.
5. рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рд╕рд╛рдареА **Redirect URI** рд░рд┐рдХреНрдд рдареЗрд╡реВ рд╢рдХрддрд╛.
6. **Register** рдХреНрд▓рд┐рдХ рдХрд░рд╛.

рдиреЛрдВрджрдгреА рдЭрд╛рд▓реНрдпрд╛рдирдВрддрд░, **Application (client) ID** рдЖрдгрд┐ **Directory (tenant) ID** рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛. рдХреЛрдбрдордзреНрдпреЗ рдпрд╛рдВрдЪреА рдЧрд░рдЬ рднрд╛рд╕реЗрд▓.

#### 2. рдХреЛрдб: рдПрдХ рд╡рд┐рд╣рдВрдЧрд╛рд╡рд▓реЛрдХрди

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣рд╛рддрд╛рд│рдгрд╛рд▒реНрдпрд╛ рдХреЛрдбрдЪреНрдпрд╛ рдореБрдЦреНрдп рднрд╛рдЧрд╛рдХрдбреЗ рдкрд╛рд╣реВрдпрд╛. рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдЪрд╛ рдкреВрд░реНрдг рдХреЛрдб [Entra ID - Local - WAM](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-local-wam) рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ [mcp-auth-servers GitHub рд░рд┐рдкреЙрдЭрд┐рдЯрд░реА](https://github.com/Azure-Samples/mcp-auth-servers) рдордзреНрдпреЗ рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ.

**`AuthenticationService.cs`**

рд╣рд╛ рд╡рд░реНрдЧ Entra ID рд╕реЛрдмрдд рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрдгреНрдпрд╛рдЪреА рдЬрдмрд╛рдмрджрд╛рд░реА рдШреЗрддреЛ.

- **`CreateAsync`**: MSAL рдордзреАрд▓ `PublicClientApplication` рд╕реБрд░реВ рдХрд░рддреЛ. рддреБрдордЪреНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдЪрд╛ `clientId` рдЖрдгрд┐ `tenantId` рд╡рд╛рдкрд░реВрди рдХреЙрдиреНрдлрд┐рдЧрд░ рдХреЗрд▓рд╛ рдЬрд╛рддреЛ.
- **`WithBroker`**: Windows Web Account Manager рд╕рд╛рд░рдЦреНрдпрд╛ рдмреНрд░реЛрдХрд░реНрд╕рдЪрд╛ рд╡рд╛рдкрд░ рд╕рдХреНрд╖рдо рдХрд░рддреЛ, рдЬреНрдпрд╛рдореБрд│реЗ рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдЖрдгрд┐ рд╕реБрд▓рдн рд╕рд┐рдВрдЧрд▓ рд╕рд╛рдЗрди-рдСрди рдЕрдиреБрднрд╡ рдорд┐рд│рддреЛ.
- **`AcquireTokenAsync`**: рдореБрдЦреНрдп рдкрджреНрдзрдд рдЖрд╣реЗ. рдкреНрд░рдердо рддреЛ рдЯреЛрдХрди рд╢рд╛рдВрддрдкрдгреЗ рдорд┐рд│рд╡рдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпрддреНрди рдХрд░рддреЛ (рдЬрд░ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪрд╛ рд╡реИрдз рд╕рддреНрд░ рдЕрд╕реЗрд▓ рддрд░ рдкреБрдиреНрд╣рд╛ рд╕рд╛рдЗрди-рдЗрди рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧрдд рдирд╛рд╣реА). рдЬрд░ рд╢рд╛рдВрдд рдЯреЛрдХрди рдорд┐рд│рд╛рд▓реЗ рдирд╛рд╣реА, рддрд░ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рдЗрдВрдЯрд░реЕрдХреНрдЯрд┐рд╡реНрд╣ рд╕рд╛рдЗрди-рдЗрдирд╕рд╛рдареА рд╡рд┐рдЪрд╛рд░рд▓реЗ рдЬрд╛рддреЗ.

```csharp
// Simplified for clarity
public static async Task<AuthenticationService> CreateAsync(ILogger<AuthenticationService> logger)
{
    var msalClient = PublicClientApplicationBuilder
        .Create(_clientId) // Your Application (client) ID
        .WithAuthority(AadAuthorityAudience.AzureAdMyOrg)
        .WithTenantId(_tenantId) // Your Directory (tenant) ID
        .WithBroker(new BrokerOptions(BrokerOptions.OperatingSystems.Windows))
        .Build();

    // ... cache registration ...

    return new AuthenticationService(logger, msalClient);
}

public async Task<string> AcquireTokenAsync()
{
    try
    {
        // Try silent authentication first
        var accounts = await _msalClient.GetAccountsAsync();
        var account = accounts.FirstOrDefault();

        AuthenticationResult? result = null;

        if (account != null)
        {
            result = await _msalClient.AcquireTokenSilent(_scopes, account).ExecuteAsync();
        }
        else
        {
            // If no account, or silent fails, go interactive
            result = await _msalClient.AcquireTokenInteractive(_scopes).ExecuteAsync();
        }

        return result.AccessToken;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "An error occurred while acquiring the token.");
        throw; // Optionally rethrow the exception for higher-level handling
    }
}
```

**`Program.cs`**

рдЗрдереЗ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реЗрдЯрдЕрдк рдХреЗрд▓рд╛ рдЬрд╛рддреЛ рдЖрдгрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗрд╡рд╛ рд╕рдорд╛рдХрд▓рд┐рдд рдХреЗрд▓реА рдЬрд╛рддреЗ.

- **`AddSingleton<AuthenticationService>`**: `AuthenticationService` рд▓рд╛ dependency injection рдХрдВрдЯреЗрдирд░рдордзреНрдпреЗ рдиреЛрдВрджрдгреА рдХрд░рддреЛ, рдЬреНрдпрд╛рдореБрд│реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдЪреНрдпрд╛ рдЗрддрд░ рднрд╛рдЧрд╛рдВрдордзреНрдпреЗ (рдЬрд╕реЗ рдХреА рд╕рд╛рдзрди) рд╡рд╛рдкрд░рддрд╛ рдпреЗрддреЗ.
- **`GetUserDetailsFromGraph` рд╕рд╛рдзрди**: рдпрд╛ рд╕рд╛рдзрдирд╛рд▓рд╛ `AuthenticationService` рдЪреА рдЧрд░рдЬ рдЕрд╕рддреЗ. рдХрд╛рд╣реАрд╣реА рдХрд░рдгреНрдпрд╛рдкреВрд░реНрд╡реА, рддреЗ `authService.AcquireTokenAsync()` рдХреЙрд▓ рдХрд░реВрди рд╡реИрдз access token рдорд┐рд│рд╡рддреЗ. рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпрд╢рд╕реНрд╡реА рдЭрд╛рд▓реНрдпрд╛рд╕, рддреЛ рдЯреЛрдХрди рд╡рд╛рдкрд░реВрди Microsoft Graph API рдХреЙрд▓ рдХрд░реВрди рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреЗ рддрдкрд╢реАрд▓ рдЖрдгрддреЗ.

```csharp
// Simplified for clarity
[McpServerTool(Name = "GetUserDetailsFromGraph")]
public static async Task<string> GetUserDetailsFromGraph(
    AuthenticationService authService)
{
    try
    {
        // This will trigger the authentication flow
        var accessToken = await authService.AcquireTokenAsync();

        // Use the token to create a GraphServiceClient
        var graphClient = new GraphServiceClient(
            new BaseBearerTokenAuthenticationProvider(new TokenProvider(authService)));

        var user = await graphClient.Me.GetAsync();

        return System.Text.Json.JsonSerializer.Serialize(user);
    }
    catch (Exception ex)
    {
        return $"Error: {ex.Message}";
    }
}
```

#### 3. рд╕рдВрдкреВрд░реНрдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╢реА рдХрд╛рд░реНрдп рдХрд░рддреЗ

1. рдЬреЗрд╡реНрд╣рд╛ MCP рдХреНрд▓рд╛рдпрдВрдЯ `GetUserDetailsFromGraph` рд╕рд╛рдзрди рд╡рд╛рдкрд░реВ рдЗрдЪреНрдЫрд┐рддреЛ, рддреЗрд╡реНрд╣рд╛ рд╕рд╛рдзрди рдкреНрд░рдердо `AcquireTokenAsync` рдХреЙрд▓ рдХрд░рддреЗ.
2. `AcquireTokenAsync` MSAL рд▓рд╛рдпрдмреНрд░рд░реАрд▓рд╛ рд╡реИрдз рдЯреЛрдХрди рддрдкрд╛рд╕рдгреНрдпрд╛рд╕ рд╕рд╛рдВрдЧрддреЗ.
3. рдЬрд░ рдЯреЛрдХрди рд╕рд╛рдкрдбрд▓рд╛ рдирд╛рд╣реА, рддрд░ MSAL рдмреНрд░реЛрдХрд░реНрд╕рдЪреНрдпрд╛ рдорд╛рдзреНрдпрдорд╛рддреВрди рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ Entra ID рдЦрд╛рддреНрдпрд╛рдиреЗ рд╕рд╛рдЗрди-рдЗрди рдХрд░рдгреНрдпрд╛рд╕ рд╕рд╛рдВрдЧрддреЗ.
4. рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рд╕рд╛рдЗрди-рдЗрди рдХреЗрд▓реНрдпрд╛рд╡рд░, Entra ID access token рдЬрд╛рд░реА рдХрд░рддреЗ.
5. рд╕рд╛рдзрди рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░реВрди Microsoft Graph API рд▓рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХреЙрд▓ рдХрд░рддреЗ.
6. рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреЗ рддрдкрд╢реАрд▓ MCP рдХреНрд▓рд╛рдпрдВрдЯрд▓рд╛ рдкрд░рдд рдорд┐рд│рддрд╛рдд.

рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рдХреА рдлрдХреНрдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗрд▓реЗрд▓реЗ рд╡рд╛рдкрд░рдХрд░реНрддреЗрдЪ рд╕рд╛рдзрди рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛рдд, рдЬреНрдпрд╛рдореБрд│реЗ рддреБрдордЪрд╛ рд╕реНрдерд╛рдирд┐рдХ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛрддреЛ.

### рдкрд░рд┐рд╕реНрдерд┐рддреА 2: рд░рд┐рдореЛрдЯ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдгреЗ (рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯрд╕рд╣)

рдЬреЗрд╡реНрд╣рд╛ рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рд░рд┐рдореЛрдЯ рдорд╢реАрдирд╡рд░ (рдЬрд╕реЗ рдХреА рдХреНрд▓рд╛рдЙрдб рд╕рд░реНрд╡реНрд╣рд░) рдЪрд╛рд▓рддреЛ рдЖрдгрд┐ HTTP Streaming рд╕рд╛рд░рдЦреНрдпрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓рд╡рд░ рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрддреЛ, рддреЗрд╡реНрд╣рд╛ рд╕реБрд░рдХреНрд╖рд╛ рдЧрд░рдЬрд╛ рд╡реЗрдЧрд│реНрдпрд╛ рдЕрд╕рддрд╛рдд. рдпрд╛ рдкрд░рд┐рд╕реНрдерд┐рддреАрдд, рддреБрдореНрд╣рд╛рд▓рд╛ **рдЧреЛрдкрдиреАрдп рдХреНрд▓рд╛рдпрдВрдЯ** рдЖрдгрд┐ **Authorization Code Flow** рд╡рд╛рдкрд░рд╛рд╡реЗ рд▓рд╛рдЧрддреЗ. рд╣реА рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдкрджреНрдзрдд рдЖрд╣реЗ рдХрд╛рд░рдг рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдЪреЗ рд░рд╣рд╕реНрдп рдмреНрд░рд╛рдЙрдЭрд░рдордзреНрдпреЗ рдХрдзреАрд╣реА рдЙрдШрдб рд╣реЛрдд рдирд╛рд╣реА.

рд╣реЗ рдЙрджрд╛рд╣рд░рдг TypeScript-рдЖрдзрд╛рд░рд┐рдд MCP рд╕рд░реНрд╡реНрд╣рд░ рд╡рд╛рдкрд░рддреЗ рдЬреЗ Express.js рд╡рд╛рдкрд░реВрди HTTP рд╡рд┐рдирдВрддреНрдпрд╛ рд╣рд╛рддрд╛рд│рддреЗ.

#### 1. Entra ID рдордзреНрдпреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╕реЗрдЯрдЕрдк рдХрд░рдгреЗ

Entra ID рдордзреНрдпреЗ рд╕реЗрдЯрдЕрдк рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯрд╕рд╛рд░рдЦрд╛рдЪ рдЖрд╣реЗ, рдкрдг рдПрдХ рдорд╣рддреНрддреНрд╡рд╛рдЪрд╛ рдлрд░рдХ рдЖрд╣реЗ: рддреБрдореНрд╣рд╛рд▓рд╛ **client secret** рддрдпрд╛рд░ рдХрд░рд╛рд╡рд╛ рд▓рд╛рдЧрддреЛ.

1. **[Microsoft Entra рдкреЛрд░реНрдЯрд▓](https://entra.microsoft.com/)** рд╡рд░ рдЬрд╛.
2. рддреБрдордЪреНрдпрд╛ рдЕреЕрдк рдиреЛрдВрджрдгреАрдордзреНрдпреЗ **Certificates & secrets** рдЯреЕрдмрд╡рд░ рдЬрд╛.
3. **New client secret** рдХреНрд▓рд┐рдХ рдХрд░рд╛, рд╡рд░реНрдгрди рджреНрдпрд╛ рдЖрдгрд┐ **Add** рдХрд░рд╛.
4. **рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ:** secret value рд▓рдЧреЗрдЪ рдХреЙрдкреА рдХрд░рд╛. рдирдВрддрд░ рддреЗ рдкрд╛рд╣рддрд╛ рдпреЗрдгрд╛рд░ рдирд╛рд╣реА.
5. рддреБрдореНрд╣рд╛рд▓рд╛ **Redirect URI** рджреЗрдЦреАрд▓ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛рд╡реА рд▓рд╛рдЧреЗрд▓. **Authentication** рдЯреЕрдмрдордзреНрдпреЗ рдЬрд╛, **Add a platform** рдХреНрд▓рд┐рдХ рдХрд░рд╛, **Web** рдирд┐рд╡рдбрд╛ рдЖрдгрд┐ рддреБрдордЪреНрдпрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рд╕рд╛рдареА redirect URI рджреНрдпрд╛ (рдЙрджрд╛. `http://localhost:3001/auth/callback`).

> **тЪая╕П рдорд╣рддреНрддреНрд╡рд╛рдЪреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реВрдЪрдирд╛:** рдЙрддреНрдкрд╛рджрди рдЕрдиреБрдкреНрд░рдпреЛрдЧрд╛рдВрд╕рд╛рдареА, Microsoft рдХрдбреВрди **secretless authentication** рдкрджреНрдзрддреА рдЬрд╕реЗ рдХреА **Managed Identity** рдХрд┐рдВрд╡рд╛ **Workload Identity Federation** рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪреА рдЬреЛрд░рджрд╛рд░ рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. client secrets рд╕реБрд░рдХреНрд╖рд┐рддрддреЗрд╕ рдзреЛрдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛рдд рдХрд╛рд░рдг рддреЗ рдЙрдШрдб рд╣реЛрдК рд╢рдХрддрд╛рдд рдХрд┐рдВрд╡рд╛ рдЪреЛрд░реА рд╣реЛрдК рд╢рдХрддрд╛рдд. Managed identities рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдкрд░реНрдпрд╛рдп рдЖрд╣реЗрдд рдХрд╛рд░рдг рддреНрдпрд╛рдд рдХреНрд░реЗрдбреЗрдиреНрд╢рд┐рдпрд▓реНрд╕ рдХреЛрдб рдХрд┐рдВрд╡рд╛ рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рдирдордзреНрдпреЗ рд╕рд╛рдард╡рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рдирд╛рд╣реА.
>
> Managed identities рдЖрдгрд┐ рддреНрдпрд╛рдВрдЪреА рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА рдХрд╢реА рдХрд░рд╛рдпрдЪреА рдпрд╛рдмрджреНрджрд▓ рдЕрдзрд┐рдХ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА, [Managed identities for Azure resources overview](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview) рдкрд╣рд╛.

#### 2. рдХреЛрдб: рдПрдХ рд╡рд┐рд╣рдВрдЧрд╛рд╡рд▓реЛрдХрди

рд╣реЗ рдЙрджрд╛рд╣рд░рдг рд╕рддреНрд░-рдЖрдзрд╛рд░рд┐рдд рдкрджреНрдзрдд рд╡рд╛рдкрд░рддреЗ. рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗрд▓реНрдпрд╛рд╡рд░, рд╕рд░реНрд╡реНрд╣рд░ access token рдЖрдгрд┐ refresh token рд╕рддреНрд░рд╛рдд рд╕рд╛рдард╡рддреЛ рдЖрдгрд┐ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рд╕рддреНрд░ рдЯреЛрдХрди рджреЗрддреЛ. рдирдВрддрд░рдЪреНрдпрд╛ рд╡рд┐рдирдВрддреНрдпрд╛рдВрд╕рд╛рдареА рд╣рд╛ рд╕рддреНрд░ рдЯреЛрдХрди рд╡рд╛рдкрд░рд▓рд╛ рдЬрд╛рддреЛ. рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдЪрд╛ рдкреВрд░реНрдг рдХреЛрдб [Entra ID - Confidential client](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-cca-session) рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ [mcp-auth-servers GitHub рд░рд┐рдкреЙрдЭрд┐рдЯрд░реА](https://github.com/Azure-Samples/mcp-auth-servers) рдордзреНрдпреЗ рдЙрдкрд▓рдмреНрдз рдЖрд╣реЗ.

**`Server.ts`**

рд╣рд╛ рдлрд╛рдЗрд▓ Express рд╕рд░реНрд╡реНрд╣рд░ рдЖрдгрд┐ MCP рдЯреНрд░рд╛рдиреНрд╕рдкреЛрд░реНрдЯ рд▓реЗрдпрд░ рд╕реЗрдЯрдЕрдк рдХрд░рддреЛ.

- **`requireBearerAuth`**: рд╣реЗ рдорд┐рдбрд▓рд╡реЗрдЕрд░ `/sse` рдЖрдгрд┐ `/message` рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░рддреЗ. рддреЗ рд╡рд┐рдирдВрддреАрдЪреНрдпрд╛ `Authorization` рд╣реЗрдбрд░рдордзреНрдпреЗ рд╡реИрдз bearer token рддрдкрд╛рд╕рддреЗ.
- **`EntraIdServerAuthProvider`**: рд╣рд╛ рдПрдХ рдХрд╕реНрдЯрдо рдХреНрд▓рд╛рд╕ рдЖрд╣реЗ рдЬреЛ `McpServerAuthorizationProvider` рдЗрдВрдЯрд░рдлреЗрд╕ рдЕрдВрдорд▓рд╛рдд рдЖрдгрддреЛ. OAuth 2.0 рдкреНрд░рд╡рд╛рд╣ рд╣рд╛рддрд╛рд│рдгреНрдпрд╛рдЪреА рдЬрдмрд╛рдмрджрд╛рд░реА рддреНрдпрд╛рдЪреА рдЖрд╣реЗ.
- **`/auth/callback`**: рд╣рд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдЪреНрдпрд╛ Entra ID рд╕рд╛рдЗрди-рдЗрди рдирдВрддрд░ redirect рд╣реЛрддреЛ. рддреЛ authorization code рдмрджрд▓реВрди access token рдЖрдгрд┐ refresh token рдорд┐рд│рд╡рддреЛ.

```typescript
// Simplified for clarity
const app = express();
const { server } = createServer();
const provider = new EntraIdServerAuthProvider();

// Protect the SSE endpoint
app.get("/sse", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... connect to the transport ...
});

// Protect the message endpoint
app.post("/message", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... handle the message ...
});

// Handle the OAuth 2.0 callback
app.get("/auth/callback", (req, res) => {
  provider.handleCallback(req.query.code, req.query.state)
    .then(result => {
      // ... handle success or failure ...
    });
});
```

**`Tools.ts`**

рд╣рд╛ рдлрд╛рдЗрд▓ MCP рд╕рд░реНрд╡реНрд╣рд░ рдкреНрд░рджрд╛рди рдХрд░рдгрд╛рд░реА рд╕рд╛рдзрдиреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЛ. `getUserDetails` рд╕рд╛рдзрди рдорд╛рдЧреАрд▓ рдЙрджрд╛рд╣рд░рдгрд╛рд╕рд╛рд░рдЦреЗрдЪ рдЖрд╣реЗ, рдкрдг рддреЗ access token рд╕рддреНрд░рд╛рддреВрди рдШреЗрддреЛ.

```typescript
// Simplified for clarity
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name } = request.params;
  const context = request.params?.context as { token?: string } | undefined;
  const sessionToken = context?.token;

  if (name === ToolName.GET_USER_DETAILS) {
    if (!sessionToken) {
      throw new AuthenticationError("Authentication token is missing or invalid. Ensure the token is provided in the request context.");
    }

    // Get the Entra ID token from the session store
    const tokenData = tokenStore.getToken(sessionToken);
    const entraIdToken = tokenData.accessToken;

    const graphClient = Client.init({
      authProvider: (done) => {
        done(null, entraIdToken);
      }
    });

    const user = await graphClient.api('/me').get();

    // ... return user details ...
  }
});
```

**`auth/EntraIdServerAuthProvider.ts`**

рд╣рд╛ рд╡рд░реНрдЧ рдЦрд╛рд▓реАрд▓ рд▓реЙрдЬрд┐рдХ рд╣рд╛рддрд╛рд│рддреЛ:

- рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ Entra ID рд╕рд╛рдЗрди-рдЗрди рдкреГрд╖реНрдард╛рд╡рд░ redirect рдХрд░рдгреЗ.
- authorization code рдмрджрд▓реВрди access token рдорд┐рд│рд╡рдгреЗ.
- `tokenStore` рдордзреНрдпреЗ рдЯреЛрдХрди рд╕рд╛рдард╡рдгреЗ.
- access token рдХрд╛рд▓рдмрд╛рд╣реНрдп рдЭрд╛рд▓реНрдпрд╛рд╡рд░ рд░рд┐рдлреНрд░реЗрд╢ рдХрд░рдгреЗ.

#### 3. рд╕рдВрдкреВрд░реНрдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╢реА рдХрд╛рд░реНрдп рдХрд░рддреЗ

1. рдЬреЗрд╡реНрд╣рд╛ рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдердо MCP рд╕рд░реНрд╡реНрд╣рд░рд╢реА рдХрдиреЗрдХреНрдЯ рд╣реЛрдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпрддреНрди рдХрд░рддреЛ, рддреЗрд╡реНрд╣рд╛ `requireBearerAuth` рдорд┐рдбрд▓рд╡реЗрдЕрд░ рдкрд╛рд╣рддреЗ рдХреА рддреНрдпрд╛рдЪреНрдпрд╛рдХрдбреЗ рд╡реИрдз рд╕рддреНрд░ рдирд╛рд╣реА рдЖрдгрд┐ рддреНрдпрд╛рд▓рд╛ Entra ID рд╕рд╛рдЗрди-рдЗрди рдкреГрд╖реНрдард╛рд╡рд░ redirect рдХрд░рддреЗ.
2. рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рддреНрдпрд╛рдЪреНрдпрд╛ Entra ID рдЦрд╛рддреНрдпрд╛рдиреЗ рд╕рд╛рдЗрди-рдЗрди рдХрд░рддреЛ.
3. Entra ID рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ `/auth/callback` рдПрдВрдбрдкреЙрдЗрдВрдЯрд╡рд░ authorization code рд╕рд╣ рдкрд░рдд рдкрд╛рдард╡рддреЗ.
4. рд╕рд░реНрд╡реНрд╣рд░ рдХреЛрдб рдмрджрд▓реВрди access token рдЖрдгрд┐ refresh token рдорд┐рд│рд╡рддреЛ, рддреНрдпрд╛рдВрдирд╛ рд╕рд╛рдард╡рддреЛ рдЖрдгрд┐ рдПрдХ session token рддрдпрд╛рд░ рдХрд░рддреЛ рдЬреЛ рдХреНрд▓рд╛рдпрдВрдЯрд▓рд╛ рдкрд╛рдард╡рд▓рд╛ рдЬрд╛рддреЛ.  
5. рдХреНрд▓рд╛рдпрдВрдЯ рдЖрддрд╛ рдпрд╛ session token рд▓рд╛ `Authorization` рд╣реЗрдбрд░рдордзреНрдпреЗ рд╡рд╛рдкрд░реВрди MCP рд╕рд░реНрд╡реНрд╣рд░рдХрдбреЗ рдкреБрдвреАрд▓ рд╕рд░реНрд╡ рд╡рд┐рдирдВрддреНрдпрд╛рдВрд╕рд╛рдареА рд╡рд╛рдкрд░реВ рд╢рдХрддреЛ.  
6. рдЬреЗрд╡реНрд╣рд╛ `getUserDetails` рдЯреВрд▓ рдХреЙрд▓ рдХреЗрд▓реЗ рдЬрд╛рддреЗ, рддреЗрд╡реНрд╣рд╛ рддреЗ session token рд╡рд╛рдкрд░реВрди Entra ID access token рд╢реЛрдзрддреЗ рдЖрдгрд┐ рдирдВрддрд░ рддреНрдпрд╛рдЪрд╛ рд╡рд╛рдкрд░ Microsoft Graph API рдХреЙрд▓ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХрд░рддреЗ.  

рд╣рд╛ рдкреНрд░рд╡рд╛рд╣ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдпрдВрдЯрдЪреНрдпрд╛ рдкреНрд░рд╡рд╛рд╣рд╛рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдЧреБрдВрддрд╛рдЧреБрдВрддреАрдЪрд╛ рдЖрд╣реЗ, рдкрдг рдЗрдВрдЯрд░рдиреЗрдЯрд╡рд░ рдЙрдкрд▓рдмреНрдз рдЕрд╕рд▓реЗрд▓реНрдпрд╛ endpoints рд╕рд╛рдареА рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдХрд╛рд░рдг рд░рд┐рдореЛрдЯ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯрд╡рд░ рдЙрдкрд▓рдмреНрдз рдЕрд╕рддрд╛рдд, рддреНрдпрд╛рдВрдирд╛ рдЕрдирдзрд┐рдХреГрдд рдкреНрд░рд╡реЗрд╢ рдЖрдгрд┐ рд╕рдВрднрд╛рд╡реНрдп рд╣рд▓реНрд▓реНрдпрд╛рдВрдкрд╛рд╕реВрди рд╕рдВрд░рдХреНрд╖рдгрд╛рд╕рд╛рдареА рдЕрдзрд┐рдХ рдордЬрдмреВрдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпрд╛рдВрдЪреА рдЧрд░рдЬ рдЕрд╕рддреЗ.  


## рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА

- **рдиреЗрд╣рдореА HTTPS рд╡рд╛рдкрд░рд╛**: рдХреНрд▓рд╛рдпрдВрдЯ рдЖрдгрд┐ рд╕рд░реНрд╡реНрд╣рд░рдордзреАрд▓ рд╕рдВрд╡рд╛рдж рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди рдЯреЛрдХрдиреНрд╕ рдЪреЛрд░реА рд╣реЛрдгреНрдпрд╛рдкрд╛рд╕реВрди рд╕рдВрд░рдХреНрд╖рдг рдорд┐рд│реЗрд▓.  
- **Role-Based Access Control (RBAC) рд▓рд╛рдЧреВ рдХрд░рд╛**: рдлрдХреНрдд рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгрд┐рдд рдЖрд╣реЗ рдХрд╛ рд╣реЗ рддрдкрд╛рд╕реВ рдирдХрд╛; рддреНрдпрд╛рд▓рд╛ рдХрд╛рдп рдЕрдзрд┐рдХрд╛рд░ рдЖрд╣реЗрдд рддреЗрд╣реА рддрдкрд╛рд╕рд╛. Entra ID рдордзреНрдпреЗ рднреВрдорд┐рдХрд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реВ рд╢рдХрддрд╛ рдЖрдгрд┐ рдЖрдкрд▓реНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ рддреНрдпрд╛рдВрдЪреА рддрдкрд╛рд╕рдгреА рдХрд░реВ рд╢рдХрддрд╛.  
- **рдирд┐рдЧрд░рд╛рдгреА рдЖрдгрд┐ рдСрдбрд┐рдЯ рдХрд░рд╛**: рд╕рд░реНрд╡ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдШрдЯрдирд╛ рд▓реЙрдЧ рдХрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди рд╕рдВрд╢рдпрд╛рд╕реНрдкрдж рдХреНрд░рд┐рдпрд╛рдХрд▓рд╛рдк рдУрд│рдЦрддрд╛ рдпреЗрддреАрд▓ рдЖрдгрд┐ рддреНрдпрд╛рд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рдпреЗрдИрд▓.  
- **рд░реЗрдЯ рд▓рд┐рдорд┐рдЯрд┐рдВрдЧ рдЖрдгрд┐ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ рд╣рд╛рддрд╛рд│рд╛**: Microsoft Graph рдЖрдгрд┐ рдЗрддрд░ API рдордзреНрдпреЗ рдЧреИрд░рд╡рд╛рдкрд░ рдЯрд╛рд│рдгреНрдпрд╛рд╕рд╛рдареА рд░реЗрдЯ рд▓рд┐рдорд┐рдЯрд┐рдВрдЧ рдЕрд╕рддреЗ. рдЖрдкрд▓реНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ рдПрдХреНрд╕реНрдкреЛрдиреЗрдВрд╢рд┐рдпрд▓ рдмреЕрдХрдСрдл рдЖрдгрд┐ рдкреБрдирдГрдкреНрд░рдпрддреНрди рд▓реЙрдЬрд┐рдХ рд▓рд╛рдЧреВ рдХрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди HTTP 429 (Too Many Requests) рдкреНрд░рддрд┐рд╕рд╛рдж рд╕реМрдореНрдпрдкрдгреЗ рд╣рд╛рддрд╛рд│рддрд╛ рдпреЗрддреАрд▓. рд╡рд╛рд░рдВрд╡рд╛рд░ рд╡рд╛рдкрд░рд▓реНрдпрд╛ рдЬрд╛рдгрд╛рд▒реНрдпрд╛ рдбреЗрдЯрд╛рдЪрд╛ рдХреЕрд╢рд┐рдВрдЧ рдХрд░рдгреЗ API рдХреЙрд▓ рдХрдореА рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЙрдкрдпреБрдХреНрдд рдард░реВ рд╢рдХрддреЗ.  
- **рдЯреЛрдХрди рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдард╡рдгреВрдХ**: access tokens рдЖрдгрд┐ refresh tokens рд╕реБрд░рдХреНрд╖рд┐рддрдкрдгреЗ рд╕рд╛рдард╡рд╛. рд╕реНрдерд╛рдирд┐рдХ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕рд╕рд╛рдареА, рд╕рд┐рд╕реНрдЯрдордЪреНрдпрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдард╡рдг рдпрдВрддреНрд░рдгрд╛рдВрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░рд╛. рд╕рд░реНрд╡реНрд╣рд░ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕рд╕рд╛рдареА, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╕рд╛рдард╡рдгреВрдХ рдХрд┐рдВрд╡рд╛ Azure Key Vault рд╕рд╛рд░рдЦреНрдпрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд╕реЗрд╡рд╛ рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рд╛.  
- **рдЯреЛрдХрди рдХрд╛рд▓рдмрд╛рд╣реНрдпрддрд╛ рд╣рд╛рддрд╛рд│рдгреА**: access tokens рдЪреА рдорд░реНрдпрд╛рджрд┐рдд рдЖрдпреБрд╖реНрдп рдЕрд╕рддреЗ. seamless рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдЕрдиреБрднрд╡ рд░рд╛рдЦрдгреНрдпрд╛рд╕рд╛рдареА refresh tokens рд╡рд╛рдкрд░реВрди рдЯреЛрдХрди рдЖрдкреЛрдЖрдк рд░рд┐рдлреНрд░реЗрд╢ рдХрд░рдгреНрдпрд╛рдЪреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рд╛, рдЬреНрдпрд╛рдореБрд│реЗ рдкреБрдирдГрдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рдЪреА рдЧрд░рдЬ рднрд╛рд╕рдгрд╛рд░ рдирд╛рд╣реА.  
- **Azure API Management рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рд╛**: рдЖрдкрд▓реНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ рдереЗрдЯ рд╕реБрд░рдХреНрд╖рд╛ рд▓рд╛рдЧреВ рдХреЗрд▓реНрдпрд╛рдиреЗ рддреБрдореНрд╣рд╛рд▓рд╛ рд╕реВрдХреНрд╖реНрдо рдирд┐рдпрдВрддреНрд░рдг рдорд┐рд│рддреЗ, рдкрдг API рдЧреЗрдЯрд╡реЗ рдЬрд╕реЗ рдХреА Azure API Management рдЕрдиреЗрдХ рд╕реБрд░рдХреНрд╖рд╛ рдмрд╛рдмреА рдЖрдкреЛрдЖрдк рд╣рд╛рддрд╛рд│реВ рд╢рдХрддрд╛рдд, рдЬрд╕реЗ рдХреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рдЕрдзрд┐рдХреГрддрддрд╛, рд░реЗрдЯ рд▓рд┐рдорд┐рдЯрд┐рдВрдЧ рдЖрдгрд┐ рдирд┐рд░реАрдХреНрд╖рдг. рд╣реЗ рдПрдХ рдХреЗрдВрджреНрд░реАрдХреГрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛рдд рдЬреЗ рдХреНрд▓рд╛рдпрдВрдЯ рдЖрдгрд┐ MCP рд╕рд░реНрд╡реНрд╣рд░ рджрд░рдореНрдпрд╛рди рдЕрд╕рддреЗ. MCP рд╕рд╛рдареА API рдЧреЗрдЯрд╡реЗ рд╡рд╛рдкрд░рдгреНрдпрд╛рдмрд╛рдмрдд рдЕрдзрд┐рдХ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА рдЖрдордЪрд╛ [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) рдкрд╣рд╛.  


## рдореБрдЦреНрдп рдореБрджреНрджреЗ

- рдЖрдкрд▓реНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рдЪреЗ рд╕рдВрд░рдХреНрд╖рдг рдХрд░рдгреЗ рд╣реЗ рдЖрдкрд▓реНрдпрд╛ рдбреЗрдЯрд╛ рдЖрдгрд┐ рдЯреВрд▓реНрд╕рдЪреЗ рд░рдХреНрд╖рдг рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЕрддреНрдпрдВрдд рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдЖрд╣реЗ.  
- Microsoft Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЖрдгрд┐ рдЕрдзрд┐рдХреГрддрддреЗрд╕рд╛рдареА рдПрдХ рдордЬрдмреВрдд рдЖрдгрд┐ рд╕реНрдХреЗрд▓реЗрдмрд▓ рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ.  
- рд╕реНрдерд╛рдирд┐рдХ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕рд╕рд╛рдареА **public client** рдЖрдгрд┐ рд░рд┐рдореЛрдЯ рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА **confidential client** рд╡рд╛рдкрд░рд╛.  
- рд╡реЗрдм рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕рд╕рд╛рдареА **Authorization Code Flow** рд╣рд╛ рд╕рд░реНрд╡рд╛рдд рд╕реБрд░рдХреНрд╖рд┐рдд рдкрд░реНрдпрд╛рдп рдЖрд╣реЗ.  


## рд╕рд░рд╛рд╡

1. рддреБрдореНрд╣реА рддрдпрд╛рд░ рдХрд░рдгрд╛рд░ рдЕрд╕рд▓реЗрд▓рд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реНрдерд╛рдирд┐рдХ рдЕрд╕реЗрд▓ рдХреА рд░рд┐рдореЛрдЯ?  
2. рддреБрдордЪреНрдпрд╛ рдЙрддреНрддрд░рд╛рдиреБрд╕рд╛рд░, рддреБрдореНрд╣реА public client рд╡рд╛рдкрд░рд╛рд▓ рдХреА confidential client?  
3. Microsoft Graph рд╡рд░ рдХреНрд░рд┐рдпрд╛ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдХреЛрдгрддреА рдкрд░рд╡рд╛рдирдЧреА рдорд╛рдЧреЗрд▓?  


## рдкреНрд░рддреНрдпрдХреНрд╖ рд╕рд░рд╛рд╡

### рд╕рд░рд╛рд╡ 1: Entra ID рдордзреНрдпреЗ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдиреЛрдВрджрдгреА рдХрд░рд╛  
Microsoft Entra рдкреЛрд░реНрдЯрд▓рд╡рд░ рдЬрд╛.  
рддреБрдордЪреНрдпрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рдирд╡реАрди рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдиреЛрдВрджрдгреА рдХрд░рд╛.  
Application (client) ID рдЖрдгрд┐ Directory (tenant) ID рдиреЛрдВрдж рдХрд░рд╛.  

### рд╕рд░рд╛рд╡ 2: рд╕реНрдерд╛рдирд┐рдХ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рд╛ (Public Client)  
- рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдгрд╛рд╕рд╛рдареА MSAL (Microsoft Authentication Library) рд╕рдорд╛рдХрд▓рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЛрдб рдЙрджрд╛рд╣рд░рдгрд╛рдЪреЗ рдЕрдиреБрд╕рд░рдг рдХрд░рд╛.  
- Microsoft Graph рдордзреВрди рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рддрдкрд╢реАрд▓ рдорд┐рд│рд╡рдгрд╛рд░рд╛ MCP рдЯреВрд▓ рдХреЙрд▓ рдХрд░реВрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣рд╛рдЪреА рдЪрд╛рдЪрдгреА рдХрд░рд╛.  

### рд╕рд░рд╛рд╡ 3: рд░рд┐рдореЛрдЯ MCP рд╕рд░реНрд╡реНрд╣рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рд╛ (Confidential Client)  
- Entra ID рдордзреНрдпреЗ confidential client рдиреЛрдВрджрдгреА рдХрд░рд╛ рдЖрдгрд┐ client secret рддрдпрд╛рд░ рдХрд░рд╛.  
- рддреБрдордЪреНрдпрд╛ Express.js MCP рд╕рд░реНрд╡реНрд╣рд░рдордзреНрдпреЗ Authorization Code Flow рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛.  
- рд╕рдВрд░рдХреНрд╖рд┐рдд endpoints рдЪреА рдЪрд╛рдЪрдгреА рдХрд░рд╛ рдЖрдгрд┐ рдЯреЛрдХрди-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рд╡реЗрд╢рд╛рдЪреА рдкреБрд╖реНрдЯреА рдХрд░рд╛.  

### рд╕рд░рд╛рд╡ 4: рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА рд▓рд╛рдЧреВ рдХрд░рд╛  
- рддреБрдордЪреНрдпрд╛ рд╕реНрдерд╛рдирд┐рдХ рдХрд┐рдВрд╡рд╛ рд░рд┐рдореЛрдЯ рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА HTTPS рд╕рдХреНрд╖рдо рдХрд░рд╛.  
- рд╕рд░реНрд╡реНрд╣рд░ рд▓реЙрдЬрд┐рдХрдордзреНрдпреЗ role-based access control (RBAC) рд▓рд╛рдЧреВ рдХрд░рд╛.  
- рдЯреЛрдХрди рдХрд╛рд▓рдмрд╛рд╣реНрдпрддрд╛ рд╣рд╛рддрд╛рд│рдгреА рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рдЯреЛрдХрди рд╕рд╛рдард╡рдгреВрдХ рдЬреЛрдбрд╛.  


## рд╕рдВрд╕рд╛рдзрдиреЗ

1. **MSAL рдЖрдврд╛рд╡рд╛ рджрд╕реНрддрдРрд╡рдЬ**  
   Microsoft Authentication Library (MSAL) рдХрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдЯреЛрдХрди рдорд┐рд│рд╡рддреЗ рд╣реЗ рдЬрд╛рдгреВрди рдШреНрдпрд╛:  
   [MSAL Overview on Microsoft Learn](https://learn.microsoft.com/en-gb/entra/msal/overview)  

2. **Azure-Samples/mcp-auth-servers GitHub рд░реЗрдкреЙрдЬрд┐рдЯрд░реА**  
   MCP рд╕рд░реНрд╡реНрд╣рд░рдЪреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рджрд╛рдЦрд╡рдгрд╛рд░реЗ рд╕рдВрджрд░реНрдн рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА:  
   [Azure-Samples/mcp-auth-servers on GitHub](https://github.com/Azure-Samples/mcp-auth-servers)  

3. **Azure Resources рд╕рд╛рдареА Managed Identities рдЖрдврд╛рд╡рд╛**  
   рд╕рд┐рд╕реНрдЯрдо рдХрд┐рдВрд╡рд╛ рд╡рд╛рдкрд░рдХрд░реНрддрд╛-рдирд┐рд░реНрдзрд╛рд░рд┐рдд managed identities рд╡рд╛рдкрд░реВрди рдЧреБрдкрд┐рддреЗ рдХрд╢реА рдЯрд╛рд│рд╛рдпрдЪреА рддреЗ рд╕рдордЬреВрди рдШреНрдпрд╛:  
   [Managed Identities Overview on Microsoft Learn](https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/)  

4. **Azure API Management: MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рддреБрдордЪреЗ Auth Gateway**  
   MCP рд╕рд░реНрд╡реНрд╣рд░рд╕рд╛рдареА рд╕реБрд░рдХреНрд╖рд┐рдд OAuth2 рдЧреЗрдЯрд╡реЗ рдореНрд╣рдгреВрди APIM рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╕рдЦреЛрд▓ рдЕрднреНрдпрд╛рд╕:  
   [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)  

5. **Microsoft Graph Permissions рд╕рдВрджрд░реНрдн**  
   Microsoft Graph рд╕рд╛рдареА рдкреНрд░рддрд┐рдирд┐рдзреАрддреНрд╡ рдЖрдгрд┐ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░рд╡рд╛рдирдЧреНрдпрд╛рдВрдЪреА рд╕рд╡рд┐рд╕реНрддрд░ рдпрд╛рджреА:  
   [Microsoft Graph Permissions Reference](https://learn.microsoft.com/zh-tw/graph/permissions-reference)  


## рд╢рд┐рдХрдгреНрдпрд╛рдЪреЗ рдкрд░рд┐рдгрд╛рдо  
рдпрд╛ рд╡рд┐рднрд╛рдЧрд╛рдирдВрддрд░, рддреБрдореНрд╣реА рд╕рдХреНрд╖рдо рдЕрд╕рд╛рд▓:

- MCP рд╕рд░реНрд╡реНрд╣рд░ рдЖрдгрд┐ AI рд╡рд░реНрдХрдлреНрд▓реЛ рд╕рд╛рдареА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдЖрд╣реЗ рд╣реЗ рд╕реНрдкрд╖реНрдЯрдкрдгреЗ рд╕рд╛рдВрдЧреВ рд╢рдХрдгреЗ.  
- рд╕реНрдерд╛рдирд┐рдХ рдЖрдгрд┐ рд░рд┐рдореЛрдЯ MCP рд╕рд░реНрд╡реНрд╣рд░ рдкрд░рд┐рд╕реНрдерд┐рддреАрд╕рд╛рдареА Entra ID рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗрдЯрдЕрдк рдЖрдгрд┐ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рдгреЗ.  
- рддреБрдордЪреНрдпрд╛ рд╕рд░реНрд╡реНрд╣рд░рдЪреНрдпрд╛ рддреИрдирд╛рддреАрд╡рд░ рдЖрдзрд╛рд░рд┐рдд рдпреЛрдЧреНрдп рдХреНрд▓рд╛рдпрдВрдЯ рдкреНрд░рдХрд╛рд░ (public рдХрд┐рдВрд╡рд╛ confidential) рдирд┐рд╡рдбрдгреЗ.  
- рд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдбрд┐рдВрдЧ рдкрджреНрдзрддреА, рдЬреНрдпрд╛рдд рдЯреЛрдХрди рд╕рд╛рдард╡рдгреВрдХ рдЖрдгрд┐ рднреВрдорд┐рдХрд╛-рдЖрдзрд╛рд░рд┐рдд рдЕрдзрд┐рдХреГрддрддрд╛ рдпрд╛рдВрдЪрд╛ рд╕рдорд╛рд╡реЗрд╢ рдЖрд╣реЗ, рдЕрдорд▓рд╛рдд рдЖрдгрдгреЗ.  
- рддреБрдордЪрд╛ MCP рд╕рд░реНрд╡реНрд╣рд░ рдЖрдгрд┐ рддреНрдпрд╛рдЪреЗ рдЯреВрд▓реНрд╕ рдЕрдирдзрд┐рдХреГрдд рдкреНрд░рд╡реЗрд╢рд╛рдкрд╛рд╕реВрди рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕рд╛рдиреЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдареЗрд╡рдгреЗ.  


## рдкреБрдвреЗ рдХрд╛рдп

- [5.13 Model Context Protocol (MCP) Integration with Azure AI Foundry](../mcp-foundry-agent-integration/README.md)

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣рд╛ рджрд╕реНрддрдРрд╡рдЬ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рд╡рд╛рдкрд░реВрди рдЕрдиреБрд╡рд╛рджрд┐рдд рдХреЗрд▓рд╛ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА, рдХреГрдкрдпрд╛ рд▓рдХреНрд╖рд╛рдд рдШреНрдпрд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрд╛рдВрдордзреНрдпреЗ рдЪреБрдХрд╛ рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪреА рдХрдорддрд░рддрд╛ рдЕрд╕реВ рд╢рдХрддреЗ. рдореВрд│ рджрд╕реНрддрдРрд╡рдЬ рддреНрдпрд╛рдЪреНрдпрд╛ рд╕реНрдерд╛рдирд┐рдХ рднрд╛рд╖реЗрдд рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рдЕрдиреБрд╡рд╛рдж рдХрд░рдгреНрдпрд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рдЕрдиреБрд╡рд╛рджрд╛рдЪреНрдпрд╛ рд╡рд╛рдкрд░рд╛рдореБрд│реЗ рдЙрджреНрднрд╡рдгрд╛рд▒реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬреБрддреА рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд▓рд╛рдЧреА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рдирд╛рд╣реА.